[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=/app/tmp/supervisord.pid
user=nextjs

[unix_http_server]
file=/app/tmp/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///app/tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:autoads-web]
command=node server.js
directory=/app
autostart=true
autorestart=true
startretries=3
stderr_logfile=/app/logs/web-error.log
stdout_logfile=/app/logs/web-output.log
stderr_logfile_maxbytes=10MB
stdout_logfile_maxbytes=10MB
environment=NODE_ENV="production",PORT="3000",HOSTNAME="0.0.0.0"
stopwaitsecs=30
stopsignal=SIGTERM

[program:autoads-scheduler]
command=tsx /app/src/scheduler.ts
directory=/app
autostart=true
autorestart=true
startretries=3
stderr_logfile=/app/logs/scheduler-error.log
stdout_logfile=/app/logs/scheduler-output.log
stderr_logfile_maxbytes=10MB
stdout_logfile_maxbytes=10MB
environment=NODE_ENV="production",RUN_SYNC_ON_START="false"
stopwaitsecs=60
stopsignal=SIGTERM

[group:autoads]
programs=autoads-web,autoads-scheduler
priority=999
