# P0é«˜çº§ä¼˜åŒ–: ç«å“å¯¹æ¯”åˆ†æ - å®Œæ•´å®ç°æ–‡æ¡£

## ğŸ“‹ å®ç°æ¦‚è§ˆ

**å®ç°æ—¥æœŸ**: 2025-11-20
**ä¼˜å…ˆçº§**: P0ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æ¨¡å—**: ç«å“å¯¹æ¯”åˆ†æç³»ç»Ÿ

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

### æ ¸å¿ƒç›®æ ‡
é€šè¿‡è‡ªåŠ¨è¯†åˆ«ç«å“å¹¶è¿›è¡Œæ·±åº¦å¯¹æ¯”åˆ†æï¼Œä¸ºå¹¿å‘Šåˆ›æ„ç”Ÿæˆæä¾›ç«äº‰å®šä½æ´å¯Ÿï¼Œå®ç°å·®å¼‚åŒ–è¥é”€ç­–ç•¥ã€‚

### é¢„æœŸROI
- **å¹¿å‘Šè½¬åŒ–ç‡(CVR)**: +15-25%ï¼ˆé€šè¿‡çªå‡ºç«äº‰ä¼˜åŠ¿å’Œå·®å¼‚åŒ–å–ç‚¹ï¼‰
- **å¹¿å‘Šç‚¹å‡»ç‡(CTR)**: +10-20%ï¼ˆé€šè¿‡ç²¾å‡†çš„ç«äº‰å®šä½å’Œä»·å€¼ä¸»å¼ ï¼‰
- **å¹¿å‘Šç›¸å…³æ€§è¯„åˆ†**: +20%ï¼ˆGoogle Adsè´¨é‡å¾—åˆ†æå‡ï¼‰
- **å¹¿å‘Šæˆæœ¬(CPC)**: -10-15%ï¼ˆè´¨é‡å¾—åˆ†æå‡å¸¦æ¥çš„æˆæœ¬é™ä½ï¼‰

### æŠ€æœ¯æ¶æ„
```
Product Page URL
    â†“
[Playwrightçˆ¬è™«] â†’ 3ç­–ç•¥ç«å“è¯†åˆ«ï¼ˆæ¯”è¾ƒè¡¨ã€æ¨èã€ç›¸ä¼¼ï¼‰
    â†“
[ç«å“æ•°æ®æå–] â†’ ASINã€åç§°ã€å“ç‰Œã€ä»·æ ¼ã€è¯„åˆ†ã€è¯„è®ºæ•°
    â†“
[å»é‡åˆå¹¶] â†’ æŒ‰ASINå»é‡ï¼Œåˆå¹¶å¤šæºç«å“
    â†“
[Gemini AIåˆ†æ] â†’ 6ç»´åº¦æ·±åº¦å¯¹æ¯”åˆ†æ
    â†“
[Databaseå­˜å‚¨] â†’ offers.competitor_analysiså­—æ®µ
    â†“
[åˆ›æ„ç”Ÿæˆé›†æˆ] â†’ å·®å¼‚åŒ–å¹¿å‘Šæ–‡æ¡ˆç­–ç•¥
```

## ğŸ“Š é—®é¢˜é™ˆè¿°

### å®ç°å‰çš„ç—›ç‚¹
1. **ç›²ç›®ç«äº‰**: ä¸äº†è§£ç«å“å®šä½ï¼Œå¹¿å‘Šç¼ºä¹å·®å¼‚åŒ–
2. **ä»·æ ¼ç­–ç•¥å¤±è¯¯**: ä¸æ¸…æ¥šä»·æ ¼ç«äº‰åŠ›ï¼Œå®šä»·ç­–ç•¥ä¸å½“
3. **å–ç‚¹é‡å¤**: æœªè¯†åˆ«ç‹¬ç‰¹å–ç‚¹ï¼Œä¸ç«å“åŒè´¨åŒ–
4. **å¼±ç‚¹æš´éœ²**: æœªè¯†åˆ«ç«å“ä¼˜åŠ¿ï¼Œé˜²å¾¡æ€§ç­–ç•¥ç¼ºå¤±
5. **æ‰‹åŠ¨åˆ†æè€—æ—¶**: äººå·¥ç«å“åˆ†æè€—æ—¶é•¿ï¼Œæ•ˆç‡ä½

### å®ç°åçš„æ”¹è¿›
1. **æ™ºèƒ½ç«å“è¯†åˆ«**: è‡ªåŠ¨ä»3ä¸ªæºè¯†åˆ«ç›¸å…³ç«å“ï¼ˆæ¯”è¾ƒè¡¨ã€æ¨èã€ç›¸ä¼¼äº§å“ï¼‰
2. **ç²¾å‡†å®šä½**: æ¸…æ™°çš„ä»·æ ¼å’Œè¯„åˆ†ç«äº‰åŠ›å®šä½
3. **å·®å¼‚åŒ–å–ç‚¹**: AIè¯†åˆ«ç‹¬ç‰¹å–ç‚¹ï¼ˆç«å“é‡‡ç”¨ç‡ä½çš„ç‰¹æ€§ï¼‰
4. **åº”å¯¹ç­–ç•¥**: é’ˆå¯¹ç«å“ä¼˜åŠ¿æä¾›ååˆ¶ç­–ç•¥
5. **è‡ªåŠ¨åŒ–åˆ†æ**: å®Œå…¨è‡ªåŠ¨åŒ–çš„ç«å“å¯¹æ¯”æµç¨‹

## ğŸ—ï¸ æŠ€æœ¯å®ç°

### 1. æ ¸å¿ƒæ¨¡å—: `src/lib/competitor-analyzer.ts` (515è¡Œ)

#### æ•°æ®ç»“æ„è®¾è®¡

```typescript
// ç«å“äº§å“ä¿¡æ¯
export interface CompetitorProduct {
  asin: string | null                   // Amazon ASINï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
  name: string                           // äº§å“åç§°
  brand: string | null                   // å“ç‰Œåç§°
  price: number | null                   // ä»·æ ¼ï¼ˆç¾å…ƒï¼‰
  priceText: string | null               // åŸå§‹ä»·æ ¼æ–‡æœ¬
  rating: number | null                  // è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰
  reviewCount: number | null             // è¯„è®ºæ•°é‡
  imageUrl: string | null                // äº§å“å›¾ç‰‡URL
  source: 'amazon_compare' | 'amazon_also_viewed' | 'amazon_similar' | 'same_category'
  similarityScore?: number               // ç›¸ä¼¼åº¦è¯„åˆ†ï¼ˆ0-1ï¼‰
  features?: string[]                    // äº§å“ç‰¹æ€§åˆ—è¡¨
}

// ä»·æ ¼ç«äº‰åŠ›åˆ†æ
export interface PricePosition {
  ourPrice: number                       // æˆ‘ä»¬çš„ä»·æ ¼
  avgCompetitorPrice: number             // ç«å“å¹³å‡ä»·æ ¼
  lowestCompetitorPrice: number          // æœ€ä½ç«å“ä»·æ ¼
  highestCompetitorPrice: number         // æœ€é«˜ç«å“ä»·æ ¼
  percentile: number                     // ä»·æ ¼ç™¾åˆ†ä½ï¼ˆ0-100ï¼‰
  advantage: 'lowest' | 'below_average' | 'average' | 'above_average' | 'premium'
  savingsPercent?: number                // ç›¸æ¯”å¹³å‡ä»·æ ¼èŠ‚çœç™¾åˆ†æ¯”
  premiumPercent?: number                // ç›¸æ¯”å¹³å‡ä»·æ ¼æº¢ä»·ç™¾åˆ†æ¯”
}

// è¯„åˆ†ç«äº‰åŠ›åˆ†æ
export interface RatingPosition {
  ourRating: number                      // æˆ‘ä»¬çš„è¯„åˆ†
  avgCompetitorRating: number            // ç«å“å¹³å‡è¯„åˆ†
  lowestCompetitorRating: number         // æœ€ä½ç«å“è¯„åˆ†
  highestCompetitorRating: number        // æœ€é«˜ç«å“è¯„åˆ†
  percentile: number                     // è¯„åˆ†ç™¾åˆ†ä½ï¼ˆ0-100ï¼‰
  advantage: 'top_rated' | 'above_average' | 'average' | 'below_average'
}

// åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ
export interface FeatureComparison {
  feature: string                        // åŠŸèƒ½åç§°
  weHave: boolean                        // æˆ‘ä»¬æ˜¯å¦æ‹¥æœ‰
  competitorsHave: number                // æ‹¥æœ‰è¯¥åŠŸèƒ½çš„ç«å“æ•°é‡
  competitorsTotal: number               // ç«å“æ€»æ•°
  adoptionRate: number                   // ç«å“é‡‡ç”¨ç‡ï¼ˆ0-1ï¼‰
  advantage: 'unique' | 'rare' | 'common' | 'missing'
}

// ç‹¬ç‰¹å–ç‚¹è¯†åˆ«
export interface UniqueSellingPoint {
  feature: string                        // åŠŸèƒ½åç§°
  weHave: boolean                        // æˆ‘ä»¬æ˜¯å¦æ‹¥æœ‰ï¼ˆå¿…é¡»ä¸ºtrueï¼‰
  competitorsHave: number                // ç«å“æ‹¥æœ‰æ•°é‡ï¼ˆå°‘ï¼‰
  uniquenessScore: number                // ç‹¬ç‰¹æ€§è¯„åˆ†ï¼ˆ0-1ï¼Œè¶Šé«˜è¶Šç‹¬ç‰¹ï¼‰
  marketingValue: 'high' | 'medium' | 'low'
}

// ç«å“ä¼˜åŠ¿ï¼ˆæˆ‘ä»¬çš„å¼±ç‚¹ï¼‰
export interface CompetitorAdvantage {
  advantage: string                      // ç«å“ä¼˜åŠ¿æè¿°
  competitorsWithAdvantage: number       // æ‹¥æœ‰è¯¥ä¼˜åŠ¿çš„ç«å“æ•°
  severity: 'critical' | 'moderate' | 'minor'
  counterStrategy: string                // åº”å¯¹ç­–ç•¥å»ºè®®
}

// å®Œæ•´ç«å“åˆ†æç»“æœ
export interface CompetitorAnalysisResult {
  competitors: CompetitorProduct[]       // ç«å“åˆ—è¡¨
  totalCompetitors: number               // ç«å“æ€»æ•°
  pricePosition: PricePosition | null    // ä»·æ ¼ç«äº‰åŠ›
  ratingPosition: RatingPosition | null  // è¯„åˆ†ç«äº‰åŠ›
  featureComparison: FeatureComparison[] // åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ
  uniqueSellingPoints: UniqueSellingPoint[] // ç‹¬ç‰¹å–ç‚¹
  competitorAdvantages: CompetitorAdvantage[] // ç«å“ä¼˜åŠ¿
  overallCompetitiveness: number         // æ•´ä½“ç«äº‰åŠ›è¯„åˆ†ï¼ˆ0-100ï¼‰
  analyzedAt: string                     // åˆ†ææ—¶é—´æˆ³
}
```

#### æ ¸å¿ƒåŠŸèƒ½å‡½æ•°

**1. ç«å“è¯†åˆ«ä¸»å‡½æ•°**
```typescript
export async function scrapeAmazonCompetitors(
  page: any,                            // Playwrighté¡µé¢å¯¹è±¡
  limit: number = 10                    // æœ€å¤šæŠ“å–ç«å“æ•°
): Promise<CompetitorProduct[]>
```
- **ç­–ç•¥1**: å°è¯•æŠ“å–"Compare with similar items"æ¯”è¾ƒè¡¨ï¼ˆæœ€ç›¸å…³ï¼‰
- **ç­–ç•¥2**: å¦‚æœæ•°é‡ä¸è¶³ï¼ŒæŠ“å–"Customers also viewed"
- **ç­–ç•¥3**: å¦‚æœä»ä¸è¶³ï¼ŒæŠ“å–"Similar items"
- **å»é‡**: æŒ‰ASINå»é‡ï¼Œä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„æ•°æ®
- **é™åˆ¶**: æœ€å¤šè¿”å›limitä¸ªç«å“

**2. AIç«å“å¯¹æ¯”åˆ†æ**
```typescript
export async function analyzeCompetitorsWithAI(
  ourProduct: {
    name: string
    price: number | null
    rating: number | null
    reviewCount: number | null
    features: string[]
  },
  competitors: CompetitorProduct[],
  targetCountry: string = 'US',
  userId?: number
): Promise<CompetitorAnalysisResult>
```
- **ä½¿ç”¨æ¨¡å‹**: Gemini 2.5 Pro
- **æ¸©åº¦**: 0.6ï¼ˆå¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§ï¼‰
- **æœ€å¤§Token**: 8192ï¼ˆæ”¯æŒè¯¦ç»†åˆ†æï¼‰
- **åˆ†æç»´åº¦**:
  1. ä»·æ ¼ç«äº‰åŠ›ï¼ˆpercentileã€advantageã€savingsï¼‰
  2. è¯„åˆ†ç«äº‰åŠ›ï¼ˆpercentileã€advantageï¼‰
  3. åŠŸèƒ½å¯¹æ¯”çŸ©é˜µï¼ˆæˆ‘ä»¬æœ‰ã€ç«å“æœ‰ã€é‡‡ç”¨ç‡ï¼‰
  4. ç‹¬ç‰¹å–ç‚¹ï¼ˆuniquenessScore > 0.6ï¼‰
  5. ç«å“ä¼˜åŠ¿ï¼ˆæˆ‘ä»¬ç¼ºå¤±çš„é‡è¦åŠŸèƒ½ï¼‰
  6. æ•´ä½“ç«äº‰åŠ›è¯„åˆ†ï¼ˆ0-100ï¼‰

**3. ä»·æ ¼å®šä½è®¡ç®—**
```typescript
function calculatePricePosition(
  ourProduct: { price: number | null },
  competitors: CompetitorProduct[]
): PricePosition | null
```
- **ç™¾åˆ†ä½è®¡ç®—**: æ¯”æˆ‘ä»¬ä¾¿å®œçš„ç«å“å æ¯”
- **ä¼˜åŠ¿çº§åˆ«**:
  - `lowest`: percentile â‰¤ 20ï¼ˆæœ€ä½ä»·ï¼‰
  - `below_average`: 20 < percentile â‰¤ 40
  - `average`: 40 < percentile â‰¤ 60
  - `above_average`: 60 < percentile â‰¤ 80
  - `premium`: percentile > 80ï¼ˆæº¢ä»·äº§å“ï¼‰
- **èŠ‚çœ/æº¢ä»·ç™¾åˆ†æ¯”**: ç›¸å¯¹äºå¹³å‡ä»·æ ¼çš„å·®å¼‚

**4. è¯„åˆ†å®šä½è®¡ç®—**
```typescript
function calculateRatingPosition(
  ourProduct: { rating: number | null },
  competitors: CompetitorProduct[]
): RatingPosition | null
```
- **ç™¾åˆ†ä½è®¡ç®—**: æ¯”æˆ‘ä»¬è¯„åˆ†ä½çš„ç«å“å æ¯”
- **ä¼˜åŠ¿çº§åˆ«**:
  - `top_rated`: percentile > 75
  - `above_average`: 50 < percentile â‰¤ 75
  - `average`: 25 < percentile â‰¤ 50
  - `below_average`: percentile â‰¤ 25

**5. åˆ›æ„æ´å¯Ÿæå–**
```typescript
export function extractCompetitiveInsights(
  analysis: CompetitorAnalysisResult
): {
  headlineSuggestions: string[]      // æ ‡é¢˜å»ºè®®
  descriptionHighlights: string[]    // æè¿°äº®ç‚¹
  calloutSuggestions: string[]       // å®£ä¼ ä¿¡æ¯å»ºè®®
  sitelinkSuggestions: string[]      // é™„åŠ é“¾æ¥å»ºè®®
}
```

### 2. çˆ¬è™«APIé›†æˆ: `src/app/api/offers/[id]/scrape/route.ts` (æ–°å¢70è¡Œ)

#### é›†æˆä½ç½®
- **è¡Œæ•°**: 667-735ï¼ˆåœ¨è¯„è®ºåˆ†æä¹‹åï¼Œæ•°æ®åº“æ›´æ–°ä¹‹å‰ï¼‰
- **è§¦å‘æ¡ä»¶**:
  - `pageType === 'product'`ï¼ˆä»…äº§å“é¡µï¼‰
  - `actualUrl.includes('amazon')`ï¼ˆä»…Amazonï¼‰
  - `aiAnalysisSuccess`ï¼ˆAIåˆ†ææˆåŠŸï¼‰

#### æ‰§è¡Œæµç¨‹
```typescript
// 1. åˆ›å»ºä¸´æ—¶Playwrightä¼šè¯
const browser = await chromium.launch({ headless: true })
const context = await browser.newContext({ userAgent: '...' })
const competitorPage = await context.newPage()

// 2. å¯¼èˆªåˆ°äº§å“é¡µé¢
await competitorPage.goto(actualUrl, { waitUntil: 'domcontentloaded', timeout: 30000 })

// 3. æŠ“å–ç«å“ï¼ˆæœ€å¤š10ä¸ªï¼‰
const competitors = await scrapeAmazonCompetitors(competitorPage, 10)

// 4. å¦‚æœæœ‰ç«å“ï¼Œæ„å»ºæˆ‘ä»¬çš„äº§å“ä¿¡æ¯
const ourProduct = {
  name: extractedBrand || brand,
  price: productInfo.pricing?.currentPrice || null,
  rating: productInfo.reviews?.averageRating || null,
  reviewCount: productInfo.reviews?.totalCount || null,
  features: productInfo.productHighlights?.split('\n').filter(f => f.trim()) || []
}

// 5. AIåˆ†æç«å“å¯¹æ¯”
competitorAnalysis = await analyzeCompetitorsWithAI(
  ourProduct,
  competitors,
  targetCountry,
  userId
)

// 6. æ¸…ç†èµ„æº
await competitorPage.close()
await browser.close()
```

#### é”™è¯¯å¤„ç†
- **éé˜»å¡**: ç«å“åˆ†æå¤±è´¥ä¸å½±å“ä¸»æµç¨‹
- **æ—¥å¿—è®°å½•**: å¤±è´¥æ—¶è®°å½•è­¦å‘Šï¼Œä¸æŠ›å‡ºé”™è¯¯
- **é™çº§ç­–ç•¥**: å¦‚æœå¤±è´¥ï¼Œ`competitorAnalysis` ä¸º `null`

### 3. æ•°æ®åº“é›†æˆ: `scripts/migrations/014_add_competitor_analysis_field.sql`

```sql
-- æ·»åŠ competitor_analysiså­—æ®µï¼ˆTEXTç±»å‹å­˜å‚¨JSONï¼‰
ALTER TABLE offers ADD COLUMN competitor_analysis TEXT;
```

**å­—æ®µè¯´æ˜**:
- **ç±»å‹**: TEXTï¼ˆå­˜å‚¨JSONæ ¼å¼çš„CompetitorAnalysisResultï¼‰
- **å¯ç©º**: æ˜¯ï¼ˆç«å“åˆ†æå¤±è´¥æˆ–éAmazonäº§å“æ—¶ä¸ºNULLï¼‰
- **å¤§å°**: é€šå¸¸5-20KBï¼ˆå–å†³äºç«å“æ•°é‡å’Œåˆ†æè¯¦ç»†åº¦ï¼‰

**å­˜å‚¨ç¤ºä¾‹**:
```json
{
  "competitors": [
    {
      "asin": "B08ABC123",
      "name": "Competitor Product Name",
      "brand": "Competitor Brand",
      "price": 29.99,
      "rating": 4.3,
      "reviewCount": 1200,
      "source": "amazon_compare",
      "features": ["feature1", "feature2"]
    }
  ],
  "totalCompetitors": 8,
  "pricePosition": {
    "ourPrice": 24.99,
    "avgCompetitorPrice": 32.50,
    "percentile": 25,
    "advantage": "lowest",
    "savingsPercent": 23
  },
  "ratingPosition": {
    "ourRating": 4.7,
    "avgCompetitorRating": 4.2,
    "percentile": 87,
    "advantage": "top_rated"
  },
  "featureComparison": [
    {
      "feature": "Waterproof IP68",
      "weHave": true,
      "competitorsHave": 5,
      "competitorsTotal": 8,
      "adoptionRate": 0.625,
      "advantage": "common"
    }
  ],
  "uniqueSellingPoints": [
    {
      "feature": "Built-in GPS",
      "weHave": true,
      "competitorsHave": 2,
      "uniquenessScore": 0.75,
      "marketingValue": "high"
    }
  ],
  "competitorAdvantages": [
    {
      "advantage": "Longer battery life (30h vs our 20h)",
      "competitorsWithAdvantage": 4,
      "severity": "moderate",
      "counterStrategy": "Emphasize faster charging and portability"
    }
  ],
  "overallCompetitiveness": 78,
  "analyzedAt": "2025-11-20T10:30:00Z"
}
```

### 4. åˆ›æ„ç”Ÿæˆé›†æˆ: `src/lib/ai.ts` (æ–°å¢65è¡Œ)

#### å‡½æ•°ç­¾åæ›´æ–°
```typescript
export async function generateAdCreatives(
  productInfo: {
    // ... å…¶ä»–å­—æ®µ ...
    competitorAnalysis?: any // ğŸ¯ P0ä¼˜åŒ–: ç«å“å¯¹æ¯”åˆ†æç»“æœ
  },
  // ...
): Promise<{
  // ... å…¶ä»–å­—æ®µ ...
  competitiveInsightsUsed?: boolean // ğŸ¯ P0ä¼˜åŒ–: æ˜¯å¦ä½¿ç”¨äº†ç«å“å¯¹æ¯”æ´å¯Ÿ
}>
```

#### ç«äº‰æ´å¯Ÿæå– (è¡Œ619-684)
```typescript
let competitiveInsightsUsed = false
let competitiveInsightsSection = ''

if (productInfo.competitorAnalysis) {
  const analysis = productInfo.competitorAnalysis
  competitiveInsightsUsed = true

  // æå–å…³é”®ç«äº‰æŒ‡æ ‡
  const priceAdv = analysis.pricePosition?.advantage || 'unknown'
  const ratingAdv = analysis.ratingPosition?.advantage || 'unknown'
  const usps = analysis.uniqueSellingPoints?.slice(0, 3).map(usp => usp.feature).join(', ')
  const competitorAdvs = analysis.competitorAdvantages?.slice(0, 3).map(adv => adv.advantage).join('; ')
  const competitiveness = analysis.overallCompetitiveness || 0

  // æ„å»ºç«äº‰æ´å¯ŸPromptæ®µè½
  competitiveInsightsSection = `

## ğŸ† ç«å“å¯¹æ¯”æ´å¯Ÿï¼ˆP0ä¼˜åŒ– - åŸºäº${analysis.totalCompetitors}ä¸ªç«å“åˆ†æï¼‰

### ç«äº‰åŠ›æ¦‚å†µ
- æ•´ä½“ç«äº‰åŠ›è¯„åˆ†: ${competitiveness}/100

### ä»·æ ¼ç«äº‰åŠ›
${priceAdvText}
${priceAdv === 'lowest' || priceAdv === 'below_average' ?
  'ğŸ’¡ **å¹¿å‘Šç­–ç•¥**: æ ‡é¢˜/æè¿°ä¸­çªå‡ºä»·æ ¼ä¼˜åŠ¿' :
  'ğŸ’¡ **å¹¿å‘Šç­–ç•¥**: é¿å…æåŠä»·æ ¼ï¼Œå¼ºè°ƒå“è´¨å’Œä»·å€¼'}

### è¯„åˆ†ç«äº‰åŠ›
${ratingAdvText}
${ratingAdv === 'top_rated' || ratingAdv === 'above_average' ?
  'ğŸ’¡ **å¹¿å‘Šç­–ç•¥**: æ ‡é¢˜ä¸­çªå‡ºé«˜è¯„åˆ†' :
  'ğŸ’¡ **å¹¿å‘Šç­–ç•¥**: é¿å…æåŠè¯„åˆ†ï¼Œå¼ºè°ƒåŠŸèƒ½å’Œåˆ›æ–°'}

### ç‹¬ç‰¹å–ç‚¹ï¼ˆç«å“è¾ƒå°‘æ‹¥æœ‰ï¼‰
${usps}
ğŸ’¡ **å¹¿å‘Šç­–ç•¥**: è¿™äº›æ˜¯å·®å¼‚åŒ–ä¼˜åŠ¿ï¼Œåº”åœ¨æ ‡é¢˜å’Œæè¿°ä¸­é‡ç‚¹çªå‡º

### ç«å“ä¼˜åŠ¿ï¼ˆéœ€è¦åº”å¯¹çš„å¼±ç‚¹ï¼‰
${competitorAdvs}
ğŸ’¡ **å¹¿å‘Šç­–ç•¥**: é€šè¿‡å¼ºè°ƒæˆ‘ä»¬çš„å…¶ä»–ä¼˜åŠ¿æ¥å¼±åŒ–è¿™äº›å¼±ç‚¹

ğŸ’¡ **æ€»ä½“åˆ›æ„ç­–ç•¥**:
1. ${priceAdv === 'lowest' ? 'æ ‡é¢˜çªå‡ºä»·æ ¼ä¼˜åŠ¿' : 'æ ‡é¢˜é¿å…ä»·æ ¼ï¼Œå¼ºè°ƒä»·å€¼'}
2. ${ratingAdv === 'top_rated' ? 'æè¿°ä¸­åŠ å…¥é«˜è¯„åˆ†' : 'æè¿°ä¸­å¼ºè°ƒäº§å“åŠŸèƒ½'}
3. ${usps ? `å®£ä¼ ä¿¡æ¯é‡ç‚¹å±•ç¤ºç‹¬ç‰¹å–ç‚¹` : 'å®£ä¼ ä¿¡æ¯å¼ºè°ƒæ ¸å¿ƒä¼˜åŠ¿'}
4. ${competitorAdvs ? 'é™„åŠ é“¾æ¥æä¾›è¯¦ç»†ä¿¡æ¯åº”å¯¹ç«å“ä¼˜åŠ¿' : 'é™„åŠ é“¾æ¥å±•ç¤ºäº§å“ä¿¡æ¯'}
`
}
```

#### Prompté›†æˆ
ç«äº‰æ´å¯Ÿæ®µè½è¢«æ·»åŠ åˆ°ä¸»Promptä¸­ï¼ˆè¡Œ697ï¼‰ï¼š
```typescript
let basePrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Google Adså¹¿å‘Šæ–‡æ¡ˆæ’°å†™ä¸“å®¶...

## äº§å“ä¿¡æ¯
å“ç‰Œåç§°: ${productInfo.brand}
å“ç‰Œæè¿°: ${productInfo.brandDescription}
...
${reviewInsightsSection}
${competitiveInsightsSection}  // ğŸ¯ ç«å“å¯¹æ¯”æ´å¯Ÿ

## å¹¿å‘Šå¯¼å‘
...
```

## ğŸ¨ AIåˆ†ææµç¨‹è¯¦è§£

### Stage 1: ç«å“è¯†åˆ«ï¼ˆMulti-Source Strategyï¼‰

#### ç­–ç•¥1: æ¯”è¾ƒè¡¨æŠ“å– (scrapeCompareTable)
**ç›®æ ‡åŒºåŸŸ**: "Compare with similar items" / "æ¯”è¾ƒç±»ä¼¼å•†å“"
```typescript
// é€‰æ‹©å™¨ç­–ç•¥
const tables = await page.$$('table.cr-comparison-table, div[data-hook="comparison-table"]')
if (tables.length === 0) return []

// æå–æ¯ä¸ªç«å“
for (const row of rows) {
  const name = await row.$eval('a.a-link-normal', el => el.textContent.trim())
  const link = await row.$eval('a.a-link-normal', el => el.getAttribute('href'))
  const asin = extractAsinFromUrl(link)

  // ä»·æ ¼æå–ï¼ˆå¤šé€‰æ‹©å™¨fallbackï¼‰
  let priceText = null
  try {
    priceText = await row.$eval('.a-price .a-offscreen', el => el.textContent.trim())
  } catch {
    try {
      priceText = await row.$eval('.a-price-whole', el => el.textContent.trim())
    } catch {
      // ä»·æ ¼ä¸å¯ç”¨
    }
  }

  // è¯„åˆ†å’Œè¯„è®ºæ•°
  const rating = await row.$eval('.a-icon-star', el => parseFloat(el.textContent))
  const reviewCount = await row.$eval('.a-size-small.a-link-normal', el => parseInt(el.textContent.replace(/,/g, '')))
}
```

**è¾“å‡ºç¤ºä¾‹**:
```typescript
[
  {
    asin: "B08ABC123",
    name: "Similar Product Name",
    brand: "Competitor Brand",
    price: 29.99,
    rating: 4.3,
    reviewCount: 1200,
    source: "amazon_compare",
    imageUrl: "https://..."
  }
]
```

#### ç­–ç•¥2: æ¨èäº§å“æŠ“å– (scrapeAlsoViewed)
**ç›®æ ‡åŒºåŸŸ**: "Customers who viewed this also viewed" / "æµè§ˆæ­¤å•†å“çš„é¡¾å®¢ä¹ŸåŒæ—¶æµè§ˆ"
```typescript
// é€‰æ‹©å™¨ç­–ç•¥
const carousels = await page.$$('div[data-hook="customers-also-viewed"], div.a-carousel')
if (carousels.length === 0) return []

// æå–æ¯ä¸ªäº§å“å¡ç‰‡
const items = await page.$$('li.a-carousel-card')
for (const item of items) {
  const name = await item.$eval('a.a-link-normal', el => el.textContent.trim())
  const link = await item.$eval('a.a-link-normal', el => el.getAttribute('href'))
  const asin = extractAsinFromUrl(link)

  // ä»·æ ¼å’Œè¯„åˆ†å¯èƒ½ä¸å®Œæ•´
  const price = await safeExtractPrice(item)
  const rating = await safeExtractRating(item)
}
```

**è¾“å‡ºç¤ºä¾‹**:
```typescript
[
  {
    asin: "B08DEF456",
    name: "Recommended Product",
    brand: null, // æ¨èåŒºåŸŸå¯èƒ½ä¸æ˜¾ç¤ºå“ç‰Œ
    price: 34.99,
    rating: 4.5,
    reviewCount: 800,
    source: "amazon_also_viewed"
  }
]
```

#### ç­–ç•¥3: ç›¸ä¼¼äº§å“æŠ“å– (scrapeSimilarItems)
**ç›®æ ‡åŒºåŸŸ**: "Similar items" / "ç›¸ä¼¼å•†å“"
```typescript
// ç±»ä¼¼scrapeAlsoViewedï¼Œä½†ç›®æ ‡ä¸åŒçš„åŒºåŸŸ
const sections = await page.$$('div[data-hook="similar-items"]')
```

#### å»é‡å’Œåˆå¹¶ (deduplicateCompetitors)
```typescript
function deduplicateCompetitors(competitors: CompetitorProduct[]): CompetitorProduct[] {
  const seen = new Map<string, CompetitorProduct>()

  for (const competitor of competitors) {
    if (!competitor.asin) continue

    // ä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„ç«å“ï¼ˆä¼˜å…ˆçº§: compare > also_viewed > similarï¼‰
    if (!seen.has(competitor.asin)) {
      seen.set(competitor.asin, competitor)
    }
  }

  return Array.from(seen.values())
}
```

### Stage 2: AIç«å“åˆ†æï¼ˆGemini 2.5 Proï¼‰

#### Promptç»“æ„
```typescript
const prompt = `You are a professional competitive analysis expert...

## Our Product
Name: ${ourProduct.name}
Price: $${ourProduct.price}
Rating: ${ourProduct.rating}â­ (${ourProduct.reviewCount} reviews)
Features:
${ourProduct.features.map(f => `- ${f}`).join('\n')}

## Competitors (${competitors.length} products)
${competitors.map((c, i) => `
${i + 1}. ${c.name}
   - Brand: ${c.brand || 'Unknown'}
   - Price: $${c.price || 'N/A'}
   - Rating: ${c.rating}â­ (${c.reviewCount} reviews)
   - Source: ${c.source}
   ${c.features ? `- Features: ${c.features.join(', ')}` : ''}
`).join('\n')}

Please analyze and return a JSON with the following structure:
{
  "pricePosition": {
    "ourPrice": number,
    "avgCompetitorPrice": number,
    "percentile": number (0-100),
    "advantage": "lowest" | "below_average" | "average" | "above_average" | "premium",
    "savingsPercent": number (if advantage is lowest/below_average)
  },
  "ratingPosition": { ... },
  "featureComparison": [
    {
      "feature": "Feature name",
      "weHave": boolean,
      "competitorsHave": number,
      "adoptionRate": number (0-1),
      "advantage": "unique" | "rare" | "common" | "missing"
    }
  ],
  "uniqueSellingPoints": [
    {
      "feature": "Feature we have that competitors rarely have",
      "competitorsHave": number,
      "uniquenessScore": number (0-1, >0.6 means truly unique),
      "marketingValue": "high" | "medium" | "low"
    }
  ],
  "competitorAdvantages": [
    {
      "advantage": "Feature/aspect where competitors are better",
      "competitorsWithAdvantage": number,
      "severity": "critical" | "moderate" | "minor",
      "counterStrategy": "How to address this in marketing"
    }
  ],
  "overallCompetitiveness": number (0-100)
}
`
```

#### AIæ¨¡å‹é…ç½®
```typescript
const model = genAI.getGenerativeModel({
  model: 'gemini-2.0-flash-exp', // Gemini 2.5 Proåˆ«å
  generationConfig: {
    temperature: 0.6,              // å¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§
    maxOutputTokens: 8192,         // æ”¯æŒè¯¦ç»†åˆ†æ
    responseMimeType: 'application/json' // å¼ºåˆ¶JSONè¾“å‡º
  }
})
```

#### åˆ†æé€»è¾‘

**ä»·æ ¼ç«äº‰åŠ›è®¡ç®—**:
1. è®¡ç®—ç«å“å¹³å‡ä»·æ ¼
2. è®¡ç®—æˆ‘ä»¬çš„ä»·æ ¼ç™¾åˆ†ä½ï¼ˆä½äºæˆ‘ä»¬ä»·æ ¼çš„ç«å“å æ¯”ï¼‰
3. æ ¹æ®ç™¾åˆ†ä½ç¡®å®šä¼˜åŠ¿çº§åˆ«ï¼š
   - percentile â‰¤ 20 â†’ `lowest`ï¼ˆæœ€ä½ä»·ï¼‰
   - 20 < percentile â‰¤ 40 â†’ `below_average`ï¼ˆä½äºå¹³å‡ï¼‰
   - 40 < percentile â‰¤ 60 â†’ `average`ï¼ˆå¹³å‡ï¼‰
   - 60 < percentile â‰¤ 80 â†’ `above_average`ï¼ˆé«˜äºå¹³å‡ï¼‰
   - percentile > 80 â†’ `premium`ï¼ˆæº¢ä»·ï¼‰
4. å¦‚æœæ˜¯`lowest`æˆ–`below_average`ï¼Œè®¡ç®—èŠ‚çœç™¾åˆ†æ¯”

**è¯„åˆ†ç«äº‰åŠ›è®¡ç®—**:
1. è®¡ç®—ç«å“å¹³å‡è¯„åˆ†
2. è®¡ç®—æˆ‘ä»¬çš„è¯„åˆ†ç™¾åˆ†ä½ï¼ˆä½äºæˆ‘ä»¬è¯„åˆ†çš„ç«å“å æ¯”ï¼‰
3. æ ¹æ®ç™¾åˆ†ä½ç¡®å®šä¼˜åŠ¿çº§åˆ«ï¼š
   - percentile > 75 â†’ `top_rated`
   - 50 < percentile â‰¤ 75 â†’ `above_average`
   - 25 < percentile â‰¤ 50 â†’ `average`
   - percentile â‰¤ 25 â†’ `below_average`

**åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ**:
1. è¯†åˆ«æˆ‘ä»¬äº§å“çš„æ‰€æœ‰ç‰¹æ€§
2. å¯¹æ¯ä¸ªç‰¹æ€§ï¼Œç»Ÿè®¡ç«å“æ‹¥æœ‰è¯¥ç‰¹æ€§çš„æ•°é‡
3. è®¡ç®—é‡‡ç”¨ç‡ï¼š`competitorsHave / totalCompetitors`
4. ç¡®å®šä¼˜åŠ¿çº§åˆ«ï¼š
   - `unique`: adoptionRate = 0ï¼ˆæˆ‘ä»¬ç‹¬æœ‰ï¼‰
   - `rare`: 0 < adoptionRate â‰¤ 0.3ï¼ˆç½•è§ï¼‰
   - `common`: 0.3 < adoptionRate â‰¤ 0.7ï¼ˆå¸¸è§ï¼‰
   - `missing`: weHave = falseï¼ˆæˆ‘ä»¬ç¼ºå¤±ï¼‰

**ç‹¬ç‰¹å–ç‚¹è¯†åˆ«**:
1. ä»åŠŸèƒ½å¯¹æ¯”ä¸­ç­›é€‰ï¼š`weHave = true` ä¸” `adoptionRate < 0.4`
2. è®¡ç®—ç‹¬ç‰¹æ€§è¯„åˆ†ï¼š`uniquenessScore = 1 - adoptionRate`
3. è¯„ä¼°è¥é”€ä»·å€¼ï¼š
   - `high`: uniquenessScore > 0.7
   - `medium`: 0.5 < uniquenessScore â‰¤ 0.7
   - `low`: uniquenessScore â‰¤ 0.5

**ç«å“ä¼˜åŠ¿è¯†åˆ«**:
1. æ‰¾å‡ºç«å“æ™®éæ‹¥æœ‰ä½†æˆ‘ä»¬ç¼ºå¤±çš„ç‰¹æ€§
2. è¯„ä¼°ä¸¥é‡ç¨‹åº¦ï¼š
   - `critical`: >70%ç«å“æ‹¥æœ‰ï¼Œæˆ‘ä»¬ç¼ºå¤±
   - `moderate`: 50-70%ç«å“æ‹¥æœ‰
   - `minor`: <50%ç«å“æ‹¥æœ‰
3. ä¸ºæ¯ä¸ªåŠ£åŠ¿ç”Ÿæˆåº”å¯¹ç­–ç•¥

**æ•´ä½“ç«äº‰åŠ›è¯„åˆ†** (0-100):
```
competitiveness = (
  priceScore * 0.25 +      // ä»·æ ¼ç«äº‰åŠ›æƒé‡25%
  ratingScore * 0.25 +     // è¯„åˆ†ç«äº‰åŠ›æƒé‡25%
  uspScore * 0.30 +        // ç‹¬ç‰¹å–ç‚¹æƒé‡30%
  defenseScore * 0.20      // é˜²å¾¡å¼±ç‚¹æƒé‡20%
)

priceScore:
  - lowest: 100
  - below_average: 80
  - average: 60
  - above_average: 40
  - premium: 60 (æº¢ä»·äº§å“ä¸ä¸€å®šå·®)

ratingScore:
  - top_rated: 100
  - above_average: 75
  - average: 50
  - below_average: 25

uspScore:
  - åŸºäºuniqueSellingPointsæ•°é‡å’ŒuniquenessScore
  - æ¯ä¸ªhigh value USP: +20åˆ†
  - æ¯ä¸ªmedium value USP: +10åˆ†
  - æ¯ä¸ªlow value USP: +5åˆ†
  - ä¸Šé™100åˆ†

defenseScore:
  - 100 - (criticalAdvantages * 30 + moderateAdvantages * 15 + minorAdvantages * 5)
  - æœ€ä½0åˆ†
```

### Stage 3: åˆ›æ„ç­–ç•¥ç”Ÿæˆ

#### ä»·æ ¼ç­–ç•¥
```typescript
// å¦‚æœæ˜¯æœ€ä½ä»·æˆ–ä½äºå¹³å‡
if (priceAdv === 'lowest' || priceAdv === 'below_average') {
  headlines: ["è¶…å€¼ä»·æ ¼", "æ€§ä»·æ¯”ä¹‹é€‰", "æ¯”ç«å“ä¾¿å®œX%"]
  descriptions: ["äº«å—æœ€ä¼˜æƒ çš„ä»·æ ¼ï¼Œæ— éœ€ç‰ºç‰²è´¨é‡"]
  callouts: ["è¶…å€¼ä¼˜æƒ ", "ä»·æ ¼ä¿è¯", "æœ€ä½³æ€§ä»·æ¯”"]
}

// å¦‚æœæ˜¯æº¢ä»·äº§å“
if (priceAdv === 'premium' || priceAdv === 'above_average') {
  headlines: ["é«˜ç«¯å“è´¨", "åŒ å¿ƒä¹‹ä½œ", "ä¸“ä¸šä¹‹é€‰"]
  descriptions: ["æŠ•èµ„äºå“è¶Šå“è´¨å’Œåˆ›æ–°æŠ€æœ¯"]
  callouts: ["é«˜ç«¯å“è´¨", "ä¸“ä¸šçº§", "æŠ€æœ¯é¢†å…ˆ"]
  // é¿å…æåŠä»·æ ¼
}
```

#### è¯„åˆ†ç­–ç•¥
```typescript
// å¦‚æœæ˜¯é«˜è¯„åˆ†
if (ratingAdv === 'top_rated' || ratingAdv === 'above_average') {
  headlines: ["4.8æ˜Ÿå¥½è¯„", "ç”¨æˆ·è®¤å¯", "é«˜åˆ†æ¨è"]
  descriptions: ["è·å¾—Xåƒåç”¨æˆ·çš„äº”æ˜Ÿå¥½è¯„"]
  callouts: ["é«˜åˆ†å¥½è¯„", "ç”¨æˆ·ä¿¡èµ–", "è®¤è¯æ¨è"]
}

// å¦‚æœè¯„åˆ†è¾ƒä½
if (ratingAdv === 'below_average') {
  // é¿å…æåŠè¯„åˆ†ï¼Œå¼ºè°ƒå…¶ä»–ä¼˜åŠ¿
  headlines: ["åˆ›æ–°æŠ€æœ¯", "åŠŸèƒ½å¼ºå¤§", "ä¸“ä¸šæœåŠ¡"]
  descriptions: ["ä¸“æ³¨äºäº§å“åŠŸèƒ½å’Œç”¨æˆ·ä½“éªŒ"]
  callouts: ["åˆ›æ–°è®¾è®¡", "æŠ€æœ¯é¢†å…ˆ", "ä¸“ä¸šæ”¯æŒ"]
}
```

#### ç‹¬ç‰¹å–ç‚¹ç­–ç•¥
```typescript
// çªå‡ºç‹¬ç‰¹å–ç‚¹ï¼ˆç«å“é‡‡ç”¨ç‡ä½ï¼‰
if (uniqueSellingPoints.length > 0) {
  const topUSP = uniqueSellingPoints[0].feature
  headlines: [`ç‹¬æœ‰${topUSP}`, `é¢†å…ˆ${topUSP}æŠ€æœ¯`, `å”¯ä¸€${topUSP}æ–¹æ¡ˆ`]
  descriptions: [`æˆ‘ä»¬æ˜¯å°‘æ•°æä¾›${topUSP}çš„å“ç‰Œä¹‹ä¸€`]
  callouts: [topUSP, "å·®å¼‚åŒ–ä¼˜åŠ¿", "ç‹¬ç‰¹åŠŸèƒ½"]
}
```

#### ç«å“ä¼˜åŠ¿åº”å¯¹ç­–ç•¥
```typescript
// è¯†åˆ«ç«å“ä¼˜åŠ¿å¹¶åˆ¶å®šåº”å¯¹ç­–ç•¥
if (competitorAdvantages.length > 0) {
  for (const adv of competitorAdvantages) {
    if (adv.severity === 'critical') {
      // å…³é”®å¼±ç‚¹ï¼šæä¾›æ›¿ä»£ä»·å€¼ä¸»å¼ 
      sitelinks: [
        { title: "äº†è§£æˆ‘ä»¬çš„ä¼˜åŠ¿", description: "è™½ç„¶Xä¸åŒï¼Œä½†Yæ›´å¼º" }
      ]
    } else if (adv.severity === 'moderate') {
      // ä¸­ç­‰å¼±ç‚¹ï¼šè½¬ç§»æ³¨æ„åŠ›åˆ°å¼ºé¡¹
      descriptions: ["æˆ‘ä»¬åœ¨Aã€Bã€Cæ–¹é¢è¡¨ç°å‡ºè‰²"]
    }
  }
}
```

## ğŸ“ˆ é¢„æœŸä¸šåŠ¡å½±å“

### çŸ­æœŸå½±å“ï¼ˆ1-2å‘¨ï¼‰
1. **å¹¿å‘Šåˆ›æ„å·®å¼‚åŒ–**: ç«‹å³ä½“ç°ç«äº‰å®šä½
2. **ç‚¹å‡»ç‡æå‡**: ç²¾å‡†çš„ä»·å€¼ä¸»å¼ å¸å¼•ç›®æ ‡ç”¨æˆ·
3. **å¹¿å‘Šç›¸å…³æ€§æå‡**: Google Adsè´¨é‡å¾—åˆ†æ”¹å–„

### ä¸­æœŸå½±å“ï¼ˆ1-2ä¸ªæœˆï¼‰
1. **è½¬åŒ–ç‡æå‡**: å·®å¼‚åŒ–å–ç‚¹å¢å¼ºè´­ä¹°æ„å‘
2. **å¹¿å‘Šæˆæœ¬é™ä½**: è´¨é‡å¾—åˆ†æå‡å¸¦æ¥CPCä¸‹é™
3. **å¸‚åœºå®šä½æ¸…æ™°**: åŸºäºæ•°æ®çš„ç«äº‰ç­–ç•¥

### é•¿æœŸå½±å“ï¼ˆ3-6ä¸ªæœˆï¼‰
1. **å“ç‰Œç«äº‰åŠ›æå‡**: æŒç»­çš„å·®å¼‚åŒ–è¥é”€
2. **ç”¨æˆ·å¿ è¯šåº¦å¢å¼º**: ç‹¬ç‰¹ä»·å€¼ä¸»å¼ å»ºç«‹å“ç‰Œè®¤çŸ¥
3. **è¥é”€æ•ˆç‡æå‡**: è‡ªåŠ¨åŒ–ç«å“åˆ†æèŠ‚çœäººå·¥

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å‰ç½®æ¡ä»¶
1. **Database Migration**: åº”ç”¨ `014_add_competitor_analysis_field.sql`
   ```bash
   sqlite3 data/autoads.db < scripts/migrations/014_add_competitor_analysis_field.sql
   ```

2. **Gemini APIé…ç½®**: ç¡®ä¿ `GEMINI_API_KEY` ç¯å¢ƒå˜é‡å·²è®¾ç½®
3. **Playwrightç¯å¢ƒ**: ç¡®ä¿Playwrightæµè§ˆå™¨å·²å®‰è£…
   ```bash
   npx playwright install chromium
   ```

### éƒ¨ç½²æ­¥éª¤

#### 1. éªŒè¯Database Migration
```bash
sqlite3 data/autoads.db "PRAGMA table_info(offers);" | grep competitor_analysis
# åº”è¯¥çœ‹åˆ°: 28|competitor_analysis|TEXT|0||0
```

#### 2. é‡å¯Development Server
```bash
npm run dev
```

#### 3. æµ‹è¯•ç«å“åˆ†æ
```bash
# åˆ›å»ºæµ‹è¯•Offerï¼ˆAmazonäº§å“é¡µï¼‰
curl -X POST http://localhost:3000/api/offers \
  -H "Content-Type: application/json" \
  -d '{
    "brand": "Test Brand",
    "url": "https://www.amazon.com/dp/B08EXAMPLE",
    "target_country": "US"
  }'

# è§¦å‘æŠ“å–ï¼ˆofferId = è¿”å›çš„IDï¼‰
curl -X POST http://localhost:3000/api/offers/{offerId}/scrape

# æ£€æŸ¥æ—¥å¿—
# åº”è¯¥çœ‹åˆ°:
# ğŸ† å¼€å§‹P0ç«å“å¯¹æ¯”åˆ†æ...
# âœ… æŠ“å–åˆ°Xä¸ªç«å“ï¼Œå¼€å§‹AIå¯¹æ¯”åˆ†æ...
# âœ… P0ç«å“å¯¹æ¯”åˆ†æå®Œæˆ
#    - ç«å“æ•°é‡: X
#    - ä»·æ ¼ä¼˜åŠ¿: lowest/below_average/...
#    - è¯„åˆ†ä¼˜åŠ¿: top_rated/above_average/...
#    - ç‹¬ç‰¹å–ç‚¹: Xä¸ª
#    - ç«å“ä¼˜åŠ¿: Xä¸ª
#    - æ•´ä½“ç«äº‰åŠ›: XX/100
```

#### 4. éªŒè¯Databaseå­˜å‚¨
```bash
sqlite3 data/autoads.db "SELECT id, brand, LENGTH(competitor_analysis) as analysis_size FROM offers WHERE competitor_analysis IS NOT NULL;"
# åº”è¯¥çœ‹åˆ°æœ‰åˆ†ææ•°æ®çš„offerï¼Œanalysis_sizeé€šå¸¸5000-20000å­—èŠ‚
```

#### 5. æµ‹è¯•åˆ›æ„ç”Ÿæˆé›†æˆ
```bash
# ç”Ÿæˆåˆ›æ„ï¼ˆä½¿ç”¨æœ‰ç«å“åˆ†æçš„offerï¼‰
curl -X POST http://localhost:3000/api/offers/{offerId}/creatives

# æ£€æŸ¥å“åº”
# åº”è¯¥åŒ…å«: "competitiveInsightsUsed": true
# æ ‡é¢˜/æè¿°åº”è¯¥ä½“ç°ç«äº‰å®šä½ï¼ˆä»·æ ¼ä¼˜åŠ¿ã€é«˜è¯„åˆ†ã€ç‹¬ç‰¹å–ç‚¹ç­‰ï¼‰
```

### å›æ»šè®¡åˆ’
å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›æ»šï¼š

#### 1. Databaseå›æ»š
```sql
-- ç§»é™¤competitor_analysiså­—æ®µ
ALTER TABLE offers DROP COLUMN competitor_analysis;
```

#### 2. Codeå›æ»š
```bash
# å›é€€åˆ°å®ç°å‰çš„commit
git log --oneline | grep "P0ç«å“å¯¹æ¯”"  # æ‰¾åˆ°å®ç°å‰çš„commit
git revert <commit-hash>
```

#### 3. ç¦ç”¨ç«å“åˆ†æï¼ˆä¸å›æ»šä»£ç ï¼‰
åœ¨ `src/app/api/offers/[id]/scrape/route.ts` ä¸­ï¼š
```typescript
// ä¸´æ—¶ç¦ç”¨ç«å“åˆ†æ
const ENABLE_COMPETITOR_ANALYSIS = false

if (ENABLE_COMPETITOR_ANALYSIS && pageType === 'product' && ...) {
  // ç«å“åˆ†æä»£ç 
}
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ä»·æ ¼ä¼˜åŠ¿äº§å“ï¼ˆæœ€ä½ä»·ï¼‰

**ç«å“åˆ†æç»“æœ**:
```json
{
  "totalCompetitors": 8,
  "pricePosition": {
    "ourPrice": 24.99,
    "avgCompetitorPrice": 32.50,
    "percentile": 12,
    "advantage": "lowest",
    "savingsPercent": 23
  },
  "ratingPosition": {
    "ourRating": 4.6,
    "avgCompetitorRating": 4.3,
    "percentile": 75,
    "advantage": "above_average"
  },
  "uniqueSellingPoints": [
    {
      "feature": "Free 2-year warranty",
      "uniquenessScore": 0.87,
      "marketingValue": "high"
    }
  ],
  "overallCompetitiveness": 82
}
```

**ç”Ÿæˆçš„å¹¿å‘Šåˆ›æ„**:
- **æ ‡é¢˜**: "è¶…å€¼ä»·æ ¼ æ¯”ç«å“ä¾¿å®œ23% | 4.6æ˜Ÿå¥½è¯„"
- **æè¿°**: "äº«å—å¸‚åœºæœ€ä¼˜æƒ ä»·æ ¼ï¼Œæ— éœ€ç‰ºç‰²è´¨é‡ã€‚å…è´¹2å¹´è´¨ä¿ï¼ŒXXåƒåç”¨æˆ·ä¿¡èµ–"
- **Callouts**: ["æœ€ä½³æ€§ä»·æ¯”", "å…è´¹è´¨ä¿", "é«˜åˆ†å¥½è¯„", "ç”¨æˆ·è®¤å¯"]
- **ç­–ç•¥**: çªå‡ºä»·æ ¼ä¼˜åŠ¿å’Œç‹¬ç‰¹å–ç‚¹ï¼ˆå…è´¹è´¨ä¿ï¼‰

### ç¤ºä¾‹2: é«˜ç«¯å®šä½äº§å“ï¼ˆæº¢ä»·ï¼‰

**ç«å“åˆ†æç»“æœ**:
```json
{
  "totalCompetitors": 6,
  "pricePosition": {
    "ourPrice": 89.99,
    "avgCompetitorPrice": 65.00,
    "percentile": 83,
    "advantage": "premium",
    "premiumPercent": 38
  },
  "ratingPosition": {
    "ourRating": 4.8,
    "avgCompetitorRating": 4.1,
    "percentile": 100,
    "advantage": "top_rated"
  },
  "uniqueSellingPoints": [
    {
      "feature": "Aerospace-grade aluminum",
      "uniquenessScore": 1.0,
      "marketingValue": "high"
    },
    {
      "feature": "50h battery life",
      "uniquenessScore": 0.83,
      "marketingValue": "high"
    }
  ],
  "overallCompetitiveness": 91
}
```

**ç”Ÿæˆçš„å¹¿å‘Šåˆ›æ„**:
- **æ ‡é¢˜**: "4.8æ˜Ÿæœ€é«˜è¯„åˆ† | èˆªç©ºçº§é“åˆé‡‘æè´¨"
- **æè¿°**: "æŠ•èµ„äºå“è¶Šå“è´¨å’Œåˆ›æ–°æŠ€æœ¯ã€‚50å°æ—¶è¶…é•¿ç»­èˆªï¼Œä¸“ä¸šäººå£«é¦–é€‰"
- **Callouts**: ["æœ€é«˜è¯„åˆ†", "èˆªç©ºçº§æè´¨", "50hç»­èˆª", "ä¸“ä¸šä¹‹é€‰"]
- **ç­–ç•¥**: é¿å…æåŠä»·æ ¼ï¼Œå¼ºè°ƒé«˜ç«¯å“è´¨å’Œç‹¬ç‰¹æŠ€æœ¯ï¼ˆèˆªç©ºçº§ã€é•¿ç»­èˆªï¼‰

### ç¤ºä¾‹3: æœ‰ç«å“ä¼˜åŠ¿éœ€åº”å¯¹çš„äº§å“

**ç«å“åˆ†æç»“æœ**:
```json
{
  "totalCompetitors": 7,
  "pricePosition": {
    "advantage": "average"
  },
  "ratingPosition": {
    "advantage": "average"
  },
  "uniqueSellingPoints": [
    {
      "feature": "Built-in AI assistant",
      "uniquenessScore": 0.71,
      "marketingValue": "high"
    }
  ],
  "competitorAdvantages": [
    {
      "advantage": "Waterproof IP68 (we only have IP67)",
      "severity": "moderate",
      "counterStrategy": "Emphasize AI features and smart automation that competitors lack"
    },
    {
      "advantage": "Larger screen size (6.5\" vs our 6.0\")",
      "severity": "minor",
      "counterStrategy": "Highlight portability and one-hand usability"
    }
  ],
  "overallCompetitiveness": 68
}
```

**ç”Ÿæˆçš„å¹¿å‘Šåˆ›æ„**:
- **æ ‡é¢˜**: "å†…ç½®AIåŠ©æ‰‹ æ™ºèƒ½è‡ªåŠ¨åŒ– | ä¾¿æºè½»å·§è®¾è®¡"
- **æè¿°**: "ç‹¬æœ‰AIæŠ€æœ¯æä¾›æ™ºèƒ½ä½“éªŒã€‚6.0è‹±å¯¸é»„é‡‘å°ºå¯¸ï¼Œå•æ‰‹æ“ä½œæ›´ä¾¿æ·"
- **Callouts**: ["å†…ç½®AI", "æ™ºèƒ½åŠ©æ‰‹", "ä¾¿æºè®¾è®¡", "å•æ‰‹æ“ä½œ"]
- **Sitelinks**:
  - "AIåŠŸèƒ½ä»‹ç»" - è¯¦ç»†å±•ç¤ºAIä¼˜åŠ¿
  - "é˜²æ°´é˜²å°˜" - è¯´æ˜IP67è¶³å¤Ÿæ—¥å¸¸ä½¿ç”¨
  - "ä¾¿æºæ€§ä¼˜åŠ¿" - å¼ºè°ƒå°å°ºå¯¸çš„å¥½å¤„
- **ç­–ç•¥**: è½¬ç§»æ³¨æ„åŠ›åˆ°ç‹¬ç‰¹AIåŠŸèƒ½ï¼Œå°†å¼±ç‚¹ï¼ˆå°å±ã€ä½é˜²æ°´ï¼‰è½¬åŒ–ä¸ºä¼˜åŠ¿ï¼ˆä¾¿æºï¼‰

### ç¤ºä¾‹4: è¯„åˆ†è¾ƒä½ä½†æœ‰ç‹¬ç‰¹å–ç‚¹çš„äº§å“

**ç«å“åˆ†æç»“æœ**:
```json
{
  "totalCompetitors": 9,
  "pricePosition": {
    "advantage": "below_average"
  },
  "ratingPosition": {
    "ourRating": 3.9,
    "avgCompetitorRating": 4.4,
    "percentile": 22,
    "advantage": "below_average"
  },
  "uniqueSellingPoints": [
    {
      "feature": "Modular design - upgradeable components",
      "uniquenessScore": 0.89,
      "marketingValue": "high"
    },
    {
      "feature": "Open-source software",
      "uniquenessScore": 0.78,
      "marketingValue": "medium"
    }
  ],
  "overallCompetitiveness": 61
}
```

**ç”Ÿæˆçš„å¹¿å‘Šåˆ›æ„**:
- **æ ‡é¢˜**: "æ¨¡å—åŒ–è®¾è®¡ å¯å‡çº§ç»„ä»¶ | å¼€æºè½¯ä»¶è‡ªç”±å®šåˆ¶"
- **æè¿°**: "åˆ›æ–°æ¨¡å—åŒ–æ¶æ„ï¼Œéšæ—¶å‡çº§æ‰©å±•ã€‚å¼€æºç³»ç»Ÿï¼Œå®Œå…¨æ§åˆ¶æ‚¨çš„è®¾å¤‡"
- **Callouts**: ["æ¨¡å—åŒ–", "å¯å‡çº§", "å¼€æºç³»ç»Ÿ", "è¶…å€¼ä»·æ ¼"]
- **ç­–ç•¥**: å®Œå…¨é¿å…æåŠè¯„åˆ†ï¼Œèšç„¦ç‹¬ç‰¹å–ç‚¹ï¼ˆæ¨¡å—åŒ–ã€å¼€æºï¼‰ï¼Œå¸å¼•ç‰¹å®šç”¨æˆ·ç¾¤ï¼ˆæŠ€æœ¯çˆ±å¥½è€…ã€DIYç”¨æˆ·ï¼‰

## ğŸ” ç›‘æ§å’Œä¼˜åŒ–

### å…³é”®æŒ‡æ ‡
1. **ç«å“è¯†åˆ«æˆåŠŸç‡**:
   - ç›®æ ‡: >80%ï¼ˆäº§å“é¡µæˆåŠŸè¯†åˆ«è‡³å°‘3ä¸ªç«å“ï¼‰
   - ç›‘æ§: `competitor_analysis IS NOT NULL AND totalCompetitors >= 3`

2. **AIåˆ†ææˆåŠŸç‡**:
   - ç›®æ ‡: >90%ï¼ˆæœ‰ç«å“æ—¶åˆ†ææˆåŠŸï¼‰
   - ç›‘æ§: æ—¥å¿—ä¸­"P0ç«å“å¯¹æ¯”åˆ†æå®Œæˆ"å‡ºç°ç‡

3. **åˆ›æ„è´¨é‡æå‡**:
   - **CTRæå‡**: å¯¹æ¯”æœ‰/æ— ç«å“åˆ†æçš„å¹¿å‘Šç»„
   - **CVRæå‡**: è¿½è¸ªè½¬åŒ–ç‡å˜åŒ–
   - **è´¨é‡å¾—åˆ†**: ç›‘æ§Google Adsè´¨é‡å¾—åˆ†

4. **æ€§èƒ½æŒ‡æ ‡**:
   - **æŠ“å–æ—¶é—´**: ç«å“åˆ†æå¹³å‡è€—æ—¶ï¼ˆç›®æ ‡: <30ç§’ï¼‰
   - **å­˜å‚¨å¤§å°**: competitor_analysiså­—æ®µå¹³å‡å¤§å°ï¼ˆç›®æ ‡: <20KBï¼‰
   - **APIæˆæœ¬**: Gemini APIè°ƒç”¨è´¹ç”¨

### ä¼˜åŒ–å»ºè®®

#### 1. æé«˜ç«å“è¯†åˆ«ç‡
å¦‚æœè¯†åˆ«ç‡ä½äº80%ï¼š
- **å¢åŠ é€‰æ‹©å™¨**: æ·»åŠ æ›´å¤šAmazoné¡µé¢å¸ƒå±€çš„é€‰æ‹©å™¨
- **æ‰©å¤§æŠ“å–èŒƒå›´**: å¢åŠ æ¯ä¸ªæºçš„æŠ“å–æ•°é‡é™åˆ¶
- **æ·»åŠ æ–°æº**: å®ç°"Sponsored products"ã€"Best sellers in category"ç­‰æ–°æº

#### 2. ä¼˜åŒ–AIåˆ†æè´¨é‡
å¦‚æœåˆ†æç»“æœä¸å‡†ç¡®ï¼š
- **è°ƒæ•´Temperature**: é™ä½åˆ°0.5æé«˜å‡†ç¡®æ€§ï¼Œæˆ–æé«˜åˆ°0.7å¢åŠ åˆ›é€ æ€§
- **å¢å¼ºPrompt**: æ·»åŠ æ›´å¤šç¤ºä¾‹å’Œå…·ä½“æŒ‡ä»¤
- **ä½¿ç”¨æ›´å¼ºæ¨¡å‹**: å‡çº§åˆ°Gemini 2.5 Ultraï¼ˆå¦‚æœå¯ç”¨ï¼‰

#### 3. å‡å°‘æŠ“å–æ—¶é—´
å¦‚æœæŠ“å–è€—æ—¶è¿‡é•¿ï¼ˆ>30ç§’ï¼‰ï¼š
- **å¹¶è¡ŒæŠ“å–**: åŒæ—¶æŠ“å–å¤šä¸ªæºçš„ç«å“
- **å‡å°‘ç­‰å¾…æ—¶é—´**: é™ä½`waitUntil`è¶…æ—¶
- **ç¼“å­˜ç«å“æ•°æ®**: å¯¹åŒä¸€äº§å“çš„ç«å“ç¼“å­˜24å°æ—¶

#### 4. é™ä½APIæˆæœ¬
å¦‚æœGemini APIæˆæœ¬è¿‡é«˜ï¼š
- **æ‰¹é‡åˆ†æ**: å¤šä¸ªäº§å“åˆå¹¶åˆ°ä¸€ä¸ªAPIè°ƒç”¨
- **é€‰æ‹©æ€§åˆ†æ**: ä»…å¯¹é«˜ä»·å€¼äº§å“ï¼ˆé«˜é¢„ç®—å¹¿å‘Šï¼‰è¿›è¡Œç«å“åˆ†æ
- **ç¼“å­˜åˆ†æç»“æœ**: ç›¸ä¼¼äº§å“å…±äº«ç«å“åˆ†æ

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç«å“æŠ“å–å¤±è´¥ï¼ˆtotalCompetitors = 0ï¼‰

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º"æœªæŠ“å–åˆ°ç«å“"

**å¯èƒ½åŸå› **:
1. Amazoné¡µé¢ç»“æ„å˜åŒ–
2. äº§å“é¡µé¢ç¡®å®æ²¡æœ‰ç«å“æ¨èåŒºåŸŸ
3. Playwrightå¯¼èˆªè¶…æ—¶æˆ–å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ‰‹åŠ¨è®¿é—®äº§å“é¡µé¢ï¼Œç¡®è®¤æ˜¯å¦æœ‰ç«å“æ¨èåŒºåŸŸ
open "https://www.amazon.com/dp/B08EXAMPLE"

# 2. æ£€æŸ¥Playwrightæ—¥å¿—
# åœ¨scrape APIä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—
console.log('Playwright page loaded:', await page.title())
console.log('Compare table found:', await page.$$('table.cr-comparison-table').length)

# 3. æˆªå›¾è°ƒè¯•
await page.screenshot({ path: 'debug-competitor-page.png', fullPage: true })
```

**è§£å†³æ–¹æ¡ˆ**:
- æ›´æ–°é€‰æ‹©å™¨ä»¥åŒ¹é…æ–°çš„Amazoné¡µé¢ç»“æ„
- æ·»åŠ æ›´å¤šfallbacké€‰æ‹©å™¨
- å¢åŠ ç­‰å¾…æ—¶é—´æˆ–ä½¿ç”¨`waitForSelector`

### é—®é¢˜2: AIåˆ†æè¿”å›ç©ºç»“æœæˆ–æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**: `competitorAnalysis` ä¸º `null` æˆ–ç¼ºå°‘å­—æ®µ

**å¯èƒ½åŸå› **:
1. Gemini APIè¿”å›éJSONæ ¼å¼
2. JSONè§£æå¤±è´¥
3. APIè¶…æ—¶æˆ–é™æµ

**æ’æŸ¥æ­¥éª¤**:
```typescript
// åœ¨analyzeCompetitorsWithAIä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—
console.log('Gemini API raw response:', result.response.text())

try {
  const parsed = JSON.parse(result.response.text())
  console.log('Parsed JSON:', JSON.stringify(parsed, null, 2))
} catch (error) {
  console.error('JSON parse error:', error)
  console.log('Invalid JSON text:', result.response.text().substring(0, 500))
}
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `responseMimeType: 'application/json'` é…ç½®
- åœ¨Promptä¸­å¼ºè°ƒJSONæ ¼å¼è¦æ±‚
- æ·»åŠ JSONä¿®å¤é€»è¾‘ï¼š
  ```typescript
  let analysisJson = result.response.text()
  // ç§»é™¤markdownä»£ç å—åŒ…è£¹
  analysisJson = analysisJson.replace(/```json\n?/g, '').replace(/```\n?/g, '')
  const analysis = JSON.parse(analysisJson)
  ```

### é—®é¢˜3: åˆ›æ„ç”Ÿæˆæœªä½¿ç”¨ç«å“æ´å¯Ÿ

**ç—‡çŠ¶**: `competitiveInsightsUsed` ä¸º `false`

**å¯èƒ½åŸå› **:
1. `productInfo.competitorAnalysis` ä¸º `undefined` æˆ– `null`
2. ç«å“åˆ†ææœªä¼ é€’åˆ°åˆ›æ„ç”Ÿæˆå‡½æ•°

**æ’æŸ¥æ­¥éª¤**:
```typescript
// åœ¨generateAdCreativesä¸­æ·»åŠ æ—¥å¿—
console.log('productInfo.competitorAnalysis:', productInfo.competitorAnalysis ? 'Present' : 'Missing')

if (productInfo.competitorAnalysis) {
  console.log('Competitor analysis details:', {
    totalCompetitors: productInfo.competitorAnalysis.totalCompetitors,
    priceAdvantage: productInfo.competitorAnalysis.pricePosition?.advantage,
    ratingAdvantage: productInfo.competitorAnalysis.ratingPosition?.advantage
  })
}
```

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤scrape APIæ­£ç¡®ä¼ é€’ `competitor_analysis` åˆ°æ•°æ®åº“
- ç¡®è®¤åˆ›æ„ç”ŸæˆAPIæ­£ç¡®è¯»å–æ•°æ®åº“å­—æ®µå¹¶ä¼ é€’åˆ°å‡½æ•°
- æ£€æŸ¥JSONè§£ææ˜¯å¦æ­£ç¡®ï¼ˆTEXTå­—æ®µéœ€è¦ `JSON.parse`ï¼‰

### é—®é¢˜4: æ€§èƒ½é—®é¢˜ï¼ˆæŠ“å–æ—¶é—´>30ç§’ï¼‰

**ç—‡çŠ¶**: ç«å“åˆ†æè€—æ—¶è¿‡é•¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ

**å¯èƒ½åŸå› **:
1. Playwrightå¯¼èˆªæˆ–ç­‰å¾…æ—¶é—´è¿‡é•¿
2. AIåˆ†æè€—æ—¶ï¼ˆGemini APIè°ƒç”¨æ…¢ï¼‰
3. å¤šä¸ªæºä¸²è¡ŒæŠ“å–

**æ’æŸ¥æ­¥éª¤**:
```typescript
// æ·»åŠ æ€§èƒ½è®¡æ—¶
const t1 = performance.now()
const competitors = await scrapeAmazonCompetitors(page, 10)
const t2 = performance.now()
console.log(`Competitor scraping took ${t2 - t1}ms`)

const analysis = await analyzeCompetitorsWithAI(...)
const t3 = performance.now()
console.log(`AI analysis took ${t3 - t2}ms`)
```

**è§£å†³æ–¹æ¡ˆ**:
- **ä¼˜åŒ–Playwright**: ä½¿ç”¨ `waitUntil: 'domcontentloaded'` è€Œé `'networkidle'`
- **å¹¶è¡ŒæŠ“å–**: åŒæ—¶æŠ“å–å¤šä¸ªæº
  ```typescript
  const [compareCompetitors, alsoViewedCompetitors, similarCompetitors] = await Promise.all([
    scrapeCompareTable(page, 5),
    scrapeAlsoViewed(page, 5),
    scrapeSimilarItems(page, 5)
  ])
  ```
- **å¼‚æ­¥åˆ†æ**: å°†ç«å“åˆ†æç§»åˆ°åå°é˜Ÿåˆ—ï¼ˆå¦‚ä½¿ç”¨BullMQï¼‰

### é—®é¢˜5: Databaseå­—æ®µè¿‡å¤§

**ç—‡çŠ¶**: `competitor_analysis` å­—æ®µè¶…è¿‡20KBï¼Œæ•°æ®åº“è¯»å†™æ…¢

**å¯èƒ½åŸå› **:
1. ç«å“æ•°é‡è¿‡å¤šï¼ˆ>10ä¸ªï¼‰
2. æ¯ä¸ªç«å“åŒ…å«å¤§é‡ç‰¹æ€§
3. AIåˆ†æç»“æœè¿‡äºè¯¦ç»†

**è§£å†³æ–¹æ¡ˆ**:
- **é™åˆ¶ç«å“æ•°é‡**: å°† `scrapeAmazonCompetitors(page, 10)` æ”¹ä¸º `scrapeAmazonCompetitors(page, 5)`
- **ç®€åŒ–æ•°æ®ç»“æ„**: ç§»é™¤ä¸å¿…è¦çš„å­—æ®µï¼ˆå¦‚ `imageUrl`ï¼‰
- **å‹ç¼©å­˜å‚¨**: ä½¿ç”¨GZIPå‹ç¼©JSONåå­˜å‚¨

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ç«å“åˆ†ææ¨¡å—**: `src/lib/competitor-analyzer.ts`
- **çˆ¬è™«API**: `src/app/api/offers/[id]/scrape/route.ts`
- **åˆ›æ„ç”Ÿæˆ**: `src/lib/ai.ts`
- **æ•°æ®åº“Migration**: `scripts/migrations/014_add_competitor_analysis_field.sql`
- **éœ€æ±‚æ–‡æ¡£**: `docs/ADVANCED_DATA_OPTIMIZATION_SUGGESTIONS.md` (Lines 180-355)

## ğŸ“ æœ€ä½³å®è·µ

### 1. ç«å“é€‰æ‹©
- **ç›¸å…³æ€§ä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨"Compare with similar items"ï¼ˆæœ€ç›¸å…³ï¼‰
- **æ•°é‡é€‚ä¸­**: 5-10ä¸ªç«å“å³å¯ï¼Œè¿‡å¤šä¼šç¨€é‡Šåˆ†æé‡ç‚¹
- **å»é‡ä¸¥æ ¼**: ç¡®ä¿åŒä¸€ASINåªå‡ºç°ä¸€æ¬¡

### 2. AI Promptä¼˜åŒ–
- **æä¾›è¶³å¤Ÿä¸Šä¸‹æ–‡**: åŒ…å«äº§å“å®Œæ•´ä¿¡æ¯å’Œæ‰€æœ‰ç«å“æ•°æ®
- **å¼ºåˆ¶JSONè¾“å‡º**: ä½¿ç”¨ `responseMimeType: 'application/json'`
- **ç¤ºä¾‹å¼•å¯¼**: åœ¨Promptä¸­æä¾›JSONç»“æ„ç¤ºä¾‹

### 3. åˆ›æ„ç­–ç•¥
- **çªå‡ºä¼˜åŠ¿**: ä»·æ ¼ä½å°±æä»·æ ¼ï¼Œè¯„åˆ†é«˜å°±æè¯„åˆ†
- **å¼±åŒ–åŠ£åŠ¿**: è¯„åˆ†ä½å°±é¿å…æåŠï¼Œè½¬è€Œå¼ºè°ƒåŠŸèƒ½å’Œåˆ›æ–°
- **å·®å¼‚åŒ–æ˜æ˜¾**: ç‹¬ç‰¹å–ç‚¹å¿…é¡»åœ¨æ ‡é¢˜ä¸­ä½“ç°
- **åº”å¯¹ç«å“**: é€šè¿‡Sitelinksè¯¦ç»†è¯´æ˜å¦‚ä½•åº”å¯¹ç«å“ä¼˜åŠ¿

### 4. æ€§èƒ½ä¼˜åŒ–
- **å¹¶è¡ŒæŠ“å–**: å¤šä¸ªæºåŒæ—¶æŠ“å–
- **è¶…æ—¶æ§åˆ¶**: å•ä¸ªæ“ä½œä¸è¶…è¿‡30ç§’
- **é”™è¯¯å®¹å¿**: ç«å“åˆ†æå¤±è´¥ä¸å½±å“ä¸»æµç¨‹
- **ç¼“å­˜ç­–ç•¥**: å¯¹åŒä¸€äº§å“çš„ç«å“åˆ†æç¼“å­˜24å°æ—¶

## ğŸ“ æ€»ç»“

P0ç«å“å¯¹æ¯”åˆ†æç³»ç»Ÿå·²å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š

âœ… **æ ¸å¿ƒæ¨¡å—** (`competitor-analyzer.ts`, 515è¡Œ)
   - 3ç­–ç•¥ç«å“è¯†åˆ«ï¼ˆæ¯”è¾ƒè¡¨ã€æ¨èã€ç›¸ä¼¼ï¼‰
   - Gemini AIæ·±åº¦å¯¹æ¯”åˆ†æï¼ˆ6ç»´åº¦ï¼‰
   - 10+ TypeScriptæ¥å£å®šä¹‰

âœ… **çˆ¬è™«APIé›†æˆ** (70è¡Œæ–°å¢ä»£ç )
   - éé˜»å¡ç«å“åˆ†ææµç¨‹
   - è‡ªåŠ¨Playwrightä¼šè¯ç®¡ç†
   - è¯¦ç»†æ—¥å¿—å’Œé”™è¯¯å¤„ç†

âœ… **æ•°æ®åº“é›†æˆ** (Migration 014)
   - `competitor_analysis` TEXTå­—æ®µ
   - JSONæ ¼å¼å­˜å‚¨å®Œæ•´åˆ†æç»“æœ

âœ… **åˆ›æ„ç”Ÿæˆé›†æˆ** (65è¡Œæ–°å¢ä»£ç )
   - ç«äº‰æ´å¯Ÿæå–å’ŒPromptæ„å»º
   - å·®å¼‚åŒ–å¹¿å‘Šç­–ç•¥ç”Ÿæˆ
   - `competitiveInsightsUsed` æ ‡å¿—

### é¢„æœŸROI
- **CVR**: +15-25%
- **CTR**: +10-20%
- **å¹¿å‘Šç›¸å…³æ€§**: +20%
- **CPC**: -10-15%

### ä¸‹ä¸€æ­¥
1. âœ… **å·²å®Œæˆ**: æ ¸å¿ƒåŠŸèƒ½å®ç°å’Œæ–‡æ¡£
2. ğŸ”„ **éƒ¨ç½²æµ‹è¯•**: åœ¨stagingç¯å¢ƒæµ‹è¯•å®Œæ•´æµç¨‹
3. ğŸ“Š **A/Bæµ‹è¯•**: å¯¹æ¯”æœ‰/æ— ç«å“åˆ†æçš„å¹¿å‘Šæ•ˆæœ
4. ğŸš€ **ç”Ÿäº§éƒ¨ç½²**: å…¨é‡ä¸Šçº¿
5. ğŸ“ˆ **æŒç»­ä¼˜åŒ–**: æ ¹æ®å®é™…æ•ˆæœä¼˜åŒ–åˆ†æç­–ç•¥

---

**å®ç°å®Œæˆæ—¥æœŸ**: 2025-11-20
**å®ç°è€…**: Claude Code
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: âœ… å®Œæ•´å®ç°ï¼Œå·²é›†æˆï¼Œå¾…éƒ¨ç½²æµ‹è¯•
