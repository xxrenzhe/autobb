# 产品需求文档（PRD）

## AutoAds "一键上广告" 系统

**版本**: v1.0
**创建日期**: 2025-01-17
**负责人**: Product Team
**状态**: Approved for Development

---

## 1. 产品概述

### 1.1 产品背景

Google Ads广告投放是企业获取流量和客户的重要渠道，但传统广告创建流程存在以下痛点：

**当前问题**：
1. **创建流程复杂**：需要在Google Ads控制台中经历10+步骤，配置Campaign、AdGroup、Keywords、Extensions等
2. **创意编写困难**：需要人工撰写15个标题、4个描述、多个Callout和Sitelink，耗时且质量参差不齐
3. **缺少优化指导**：不知道如何设置关键词匹配类型、如何优化广告文案、如何分配预算
4. **数据分析门槛高**：Google Ads后台复杂，普通用户难以快速理解数据和优化方向
5. **多账号管理困难**：代理商或SaaS公司管理100+广告账号时，重复性工作量巨大

**目标用户**：
- **核心用户**：中小企业营销人员、创业者、个人广告主
- **次要用户**：广告代理商、SaaS产品运营人员
- **用户规模**：初期目标1000+活跃用户

### 1.2 产品定位

**AutoAds** 是一款基于AI的Google Ads广告创建和管理工具，旨在：
- 将复杂的广告创建流程简化为"一键上广告"
- 通过AI自动生成高质量广告创意
- 提供数据大盘和智能优化建议，降低优化门槛
- 采用后端SQLite数据库架构，确保数据安全、持久化和跨设备同步

**核心价值主张**：
> "3分钟创建专业Google Ads广告，AI助力提升50%创意质量，数据可视化助你轻松优化"

### 1.3 产品目标

**短期目标（3个月）**：
- 实现核心6大功能：Offer创建、广告创建、创意生成、广告上线、数据同步、数据大盘
- 用户平均创建广告时间从30分钟降低到5分钟
- AI生成创意质量评分平均达到75+/100

**中期目标（6个月）**：
- 支持10种以上行业模板
- 新增关键词扩展和否定词建议功能
- 集成Google Ads Recommendations API

**长期目标（12个月）**：
- 支持Performance Max、Display、Shopping等更多广告类型
- 提供竞品分析和市场洞察功能
- 构建广告投放知识库和最佳实践库

---

## 2. 用户管理与认证

### 2.1 用户注册与登录

**功能描述**：
系统采用后端SQLite数据库架构，支持多用户管理，每个用户拥有独立的数据空间。

**用户模型**：
| 角色 | 权限 | 说明 |
|------|------|------|
| **管理员** (admin) | 完全权限 | 可管理所有用户、查看所有数据 |
| **普通用户** (user) | 个人数据权限 | 只能访问自己的Offers和Campaigns |

**功能要求**：

#### 用户登录
- 用户名 + 密码登录
- JWT Token认证（有效期7天）
- "记住我"功能（延长token有效期）
- 登录失败限流（5次失败锁定5分钟）

#### 用户注册
- 初始版本由管理员创建用户账号
- 用户首次登录强制修改密码
- 包含套餐类型和有效期设置

**套餐类型**：
| 套餐 | 价格 | 有效期 | 说明 |
|------|------|--------|------|
| 年卡 | ¥5,999 | 365天 | 适合BB新人 |
| 终身买断 | ¥10,999 | 100年 | 适合持续投入的个人 |
| 私有化部署 | ¥29,999 | 1年+续签 | 独立工作室，含技术支持 |
| 试用套餐 | 免费 | 7/14/30天 | 市场推广活动 |

**数据隔离**：
- 每个用户只能看到自己创建的Offers和Campaigns
- 通过`user_id`字段实现数据库层隔离
- API层验证JWT token中的userId

**交互流程**：
```
1. 用户打开系统 → 检查登录状态
   └─ 未登录 → 跳转登录页
   └─ 已登录 → 验证token有效期
      └─ 已过期 → 提示重新登录
      └─ 未过期 → 进入Dashboard

2. 用户输入用户名和密码 → 点击登录
3. 后端验证凭据
   └─ 成功 → 返回JWT token
   └─ 失败 → 显示错误信息 + 限流检查

4. 前端存储token → 跳转Dashboard
5. 后续所有API请求携带token
```

### 2.2 数据安全与隐私

**安全措施**：
- 密码使用bcrypt加密存储（cost=10）
- OAuth Token使用AES-256-GCM加密
- JWT Secret使用64位随机密钥
- API请求限流防止滥用
- 数据库连接使用单例模式
- 并发更新使用乐观锁（version字段）

**数据备份**：
- 后端SQLite自动每日备份
- 保留最近30天备份
- 用户可通过管理员导出数据

**跨设备同步**：
- 用户在任何设备登录即可访问数据
- 数据实时从后端数据库加载
- 前端缓存提升访问速度

---

## 3. 核心功能需求

### 3.1 快速创建Offer

**功能描述**：
用户可以快速创建一个"Offer"（营销主张/产品推广），作为后续广告创建的基础。

**用户故事**：
> 作为一名电商卖家，我想快速创建一个新产品的推广Offer，以便后续为其创建Google Ads广告。

**功能要求**：

| 字段 | 类型 | 是否必填 | 说明 | 示例 |
|------|------|----------|------|------|
| Offer名称 | 文本 | 是 | 内部标识，用户自定义 | "2025春季促销 - Reolink摄像头" |
| **推广链接** | URL | 是 | **Offer跟踪链接**（最终投放URL） | "https://pboost.me/UKTs4I6" |
| **推广国家** | 下拉选择 | 是 | **广告投放国家/地区** | "美国 (US)" |
| **推广语言** | 文本 | 自动 | **根据国家自动推导**（US→English） | "English" |
| 品牌名称 | 文本 | 是 | 品牌或产品名称，≤25字符 | "Reolink" |
| **店铺/详情页** | URL | 是 | **Amazon店铺或商品详情页**（用于数据抓取） | "https://www.amazon.com/stores/page/201E3A4F..." |
| 产品描述 | 多行文本 | 是 | 产品/服务的详细描述 | "4K智能安防摄像头，支持夜视、双向语音..." |
| 着陆页URL | URL | 自动 | 广告点击后的目标页面（与推广链接相同） | "https://pboost.me/UKTs4I6" |
| 关键词 | 标签列表 | 是 | 至少1个关键词（支持查询搜索量） | ["security camera", "outdoor camera"] |
| 产品类目 | 下拉选择 | 否 | 辅助AI生成更精准创意 | "安防监控" |
| 目标受众 | 文本 | 否 | 受众描述 | "25-55岁，拥有房产的家庭用户" |

**字段说明**：
- **推广链接**：用户的Affiliate或跟踪链接，广告点击后跳转到此URL
- **推广国家**：决定Google Ads投放地理位置和广告语言
  - ⚠️ **重要限制**：一个Offer只支持单一国家/语言推广
  - 如需多语言推广，需为每种语言创建独立的Offer
  - 示例：推广美国需创建"Offer-US"，推广德国需创建"Offer-GE"
- **推广语言**：系统根据国家自动映射（US→en, GE→de, FR→fr等）
- **店铺/详情页**：用于AI抓取产品信息（标题、卖点、图片等），生成更精准的广告创意
- **着陆页URL**：默认等于推广链接，用户可修改

**多语言推广示例**：
```
场景：同一产品需要推广到美国和德国

正确做法：
Offer 1: "Reolink摄像头-美国" → targetCountry=US → targetLanguage=English
Offer 2: "Reolink摄像头-德国" → targetCountry=GE → targetLanguage=German

错误做法：
❌ 一个Offer同时选择US和GE（系统不支持）
```

**交互流程**：
```
1. 用户点击"创建Offer"按钮
2. 填写表单（支持草稿自动保存到本地）
3. 点击"保存" → 提交到后端API → 保存到SQLite数据库
4. 跳转到Offer列表页，显示新创建的Offer
```

**验证规则**：
- 推广链接必须是有效URL（支持http/https协议）
- 推广国家必须从预设列表选择（US、UK、CA、AU、GE、FR、ES、IT、JP、CN等）
- 品牌名称≤25字符
- 店铺/详情页URL必须有效（支持Amazon、独立站等）
- 至少添加1个关键词
- 产品描述≥50字符（建议）

**国家→语言自动映射**：
| 国家代码 | 国家名称 | 推广语言 | Google Ads Geo Target ID |
|---------|---------|---------|--------------------------|
| US | 美国 | English | 2840 |
| UK | 英国 | English | 2826 |
| CA | 加拿大 | English/French | 2124 |
| AU | 澳大利亚 | English | 2036 |
| GE | 德国 | German | 2276 |
| FR | 法国 | French | 2250 |
| ES | 西班牙 | Spanish | 2724 |
| IT | 意大利 | Italian | 2380 |
| JP | 日本 | Japanese | 2392 |
| CN | 中国 | Chinese | 2156 |

**成功指标**：
- 用户平均完成时间 < 2分钟
- Offer创建完成率 > 85%

---

### 3.2 快速为Offer创建广告

**功能描述**：
用户选择一个Offer，点击"一键上广告"，系统自动生成广告创意并创建Google Ads Campaign。

**用户故事**：
> 作为一名营销人员，我想为我的产品Offer快速创建Google Ads搜索广告，无需手动配置复杂的Campaign设置。

**功能要求**：

**输入**：
- 选择已有Offer
- 选择Google Ads账号
- 选择广告变体数量（1/2/3个，用于A/B测试）

**自动配置项**：
| 配置项 | 自动规则 | 用户可修改 |
|--------|----------|-----------|
| Campaign Name | "{Offer名称} - {变体类型}" | 否 |
| Daily Budget | 100（账号货币） | 否（当前版本固定） |
| Campaign Type | Search | 否 |
| Ad Format | RSA（响应式搜索广告） | 否 |
| Keywords | 从Offer继承，自动分类匹配类型 | 否（AI智能分类） |
| Business Name | 基于品牌名称自动生成（≤25字符） | 是（AI生成后可编辑） |
| Callouts | AI从网站分析生成 | 是（可编辑） |
| Sitelinks | AI从网站导航生成 | 是（可编辑） |
| Images/Logo | 用户手动上传（提供操作指引） | 手动 |

**广告变体策略**：

用户选择创建多少个广告变体：

| 变体数量 | 变体组合 | 说明 |
|---------|---------|------|
| 1个 | 品牌导向 | 强调品牌信任度、历史、承诺 |
| 2个 | 品牌导向 + 功能导向 | 增加功能特性、技术优势的变体 |
| 3个 | 品牌导向 + 功能导向 + 价值导向 | 再增加客户收益、性价比的变体 |

**每个变体独立创建**：
- 独立的Campaign
- 独立的100/天预算
- 不同的创意角度和关键词分布

**交互流程**：
```
1. Offer列表页 → 点击Offer卡片的"一键上广告"按钮
2. 弹出配置弹窗：
   - 选择Google Ads账号
   - 选择变体数量（1/2/3）
3. 点击"生成广告创意" → 进入创意生成流程（功能2.3）
4. 用户确认创意后 → 调用Google Ads API创建Campaign
5. 显示创建进度：Campaign → AdGroup → Ad → Keywords → Assets
6. 创建完成 → 显示成功页面 + 引导用户上传Logo/Images
```

**成功指标**：
- 广告创建成功率 > 95%
- 用户从点击按钮到广告上线 < 5分钟

---

### 3.3 快速生成广告创意

**功能描述**：
基于Offer信息和品牌网站，AI自动生成15个Headlines、4个Descriptions、3-4个Callouts、3-4个Sitelinks，并提供质量评分和重新生成功能。

**用户故事**：
> 作为一名不擅长文案的创业者，我希望AI能帮我生成专业的广告文案，并告诉我质量如何，如果不满意可以重新生成。

**功能要求**：

**AI生成流程**：
```
1. 输入数据收集
   ├─ Offer基本信息（品牌名、产品描述、关键词）
   ├─ 着陆页URL
   └─ 变体策略（品牌/功能/价值导向）

2. 网站分析（带Fallback）
   ├─ Level 1: 爬取网站 → 提取导航、USP、页面内容
   ├─ Level 2: 爬取失败 → 使用AI模板生成（基于行业模板）
   └─ Level 3: AI失败 → 用户手动输入

3. AI创意生成
   ├─ 15个Headlines（每个≤30字符）
   │  └─ 覆盖品牌词、产品词、功能词、价值词
   ├─ 4个Descriptions（每个≤90字符）
   │  └─ 阐述产品价值、差异化、CTA
   ├─ 3-4个Callouts（每个≤25字符）
   │  └─ 基于网站USP提炼
   └─ 3-4个Sitelinks（每个≤25字符 + URL）
      └─ 基于网站导航结构

4. 质量评分（0-100分）
   ├─ 关键词相关性（30%）：关键词在创意中的覆盖率
   ├─ 创意多样性（20%）：表达角度的丰富度
   ├─ 关键词覆盖率（30%）：使用了多少个关键词
   └─ 官网一致性（20%）：与网站内容的匹配度
```

**用户交互**：

1. **生成中状态**：
   - 显示进度条和当前步骤
   - "正在分析网站..." → "正在生成创意..." → "正在评分..."

2. **生成结果展示**：
```
┌─────────────────────────────────────────┐
│  广告创意质量评分                         │
│  ┌─────┐                                 │
│  │ 82  │  / 100                          │
│  └─────┘                                 │
│  优秀  ✅                                 │
│                                          │
│  评分明细：                               │
│  关键词相关性    ████████░░ 85%           │
│  创意多样性      ███████░░░ 75%           │
│  关键词覆盖率    ████████░░ 80%           │
│  官网一致性      █████████░ 90%           │
│                                          │
│  [🔄 重新生成]  [✅ 确认使用]           │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  标题 (15个)  ✏️编辑                    │
├─────────────────────────────────────────┤
│  1. Nike专业跑鞋 轻便透气               │
│  2. 马拉松训练首选 Nike跑步鞋           │
│  3. 探索Nike跑鞋系列 立即选购           │
│  ...                                    │
│  15. [点击添加或编辑]                   │
└─────────────────────────────────────────┘

[类似展示Descriptions、Callouts、Sitelinks]
```

3. **编辑功能**：
   - 点击任意创意元素 → 进入编辑模式
   - 实时显示字符计数（如：28/30）
   - 超长自动标红提示
   - 支持添加/删除创意元素

4. **重新生成功能**：
   - 点击"重新生成" → 使用新的AI种子重新生成
   - 保留历史版本，用户可回退
   - 显示版本号（Version 1, Version 2...）

5. **版本管理**：
```
┌─────────────────────────────────────────┐
│  历史版本                                │
├─────────────────────────────────────────┤
│  ✓ Version 3 (当前)  评分: 82  [查看]  │
│    Version 2          评分: 75  [恢复]  │
│    Version 1          评分: 68  [恢复]  │
└─────────────────────────────────────────┘
```

**质量评分算法**：
```typescript
overall_score = (
  keyword_relevance * 0.30 +
  creative_diversity * 0.20 +
  keyword_coverage * 0.30 +
  website_alignment * 0.20
) * 100

grade:
  >= 80: "优秀" (绿色)
  60-79: "良好" (黄色)
  < 60: "需要改进" (红色)
```

**成功指标**：
- AI生成成功率 > 98%
- 平均质量评分 > 75
- 用户重新生成次数 < 2次
- 用户编辑率 < 30%（说明AI质量高）

---

### 3.4 真实上线广告

**功能描述**：
通过Google Ads API创建真实的Campaign、AdGroup、Ad、Keywords和Assets，并引导用户完成手动步骤。

**用户故事**：
> 作为广告主，我希望一键创建的广告能真正上线到Google Ads，而不是假的或需要我再手动配置。

**功能要求**：

**创建流程**：
```
1. 用户确认创意后，点击"确认创建广告"

2. 后台API调用（10步骤）：
   Step 1: 创建Budget（固定100/天，账号货币）
   Step 2: 创建Campaign（Search, 目标网络）
   Step 3: 创建AdGroup
   Step 4: 创建RSA Ad（15 Headlines + 4 Descriptions）
   Step 5: 添加Keywords（智能分类匹配类型）
   Step 6: 创建Business Name Asset
   Step 7: 创建Callout Assets（3-4个）
   Step 8: 创建Sitelink Assets（3-4个）
   Step 9: 链接Assets到Campaign
   Step 10: 验证创建结果

3. 初始状态设置为 PAUSED（暂停）
   原因：等待用户上传Logo/Images并审核

4. 显示创建结果页面
```

**创建结果页面**：
```
┌─────────────────────────────────────────┐
│  ✅ 广告创建成功！                       │
├─────────────────────────────────────────┤
│  已创建 2 个广告变体:                    │
│                                          │
│  📊 Nike跑鞋促销 - 品牌导向              │
│     Campaign ID: 123456789              │
│     Daily Budget: ¥100                  │
│     Status: PAUSED ⏸                    │
│                                          │
│  📊 Nike跑鞋促销 - 功能导向              │
│     Campaign ID: 123456790              │
│     Daily Budget: ¥100                  │
│     Status: PAUSED ⏸                    │
│                                          │
│  总预算: ¥200/天                         │
├─────────────────────────────────────────┤
│  ⚠️ 完成以下步骤后，请激活广告:          │
│                                          │
│  1. 📸 上传Business Logo                │
│     [打开Google Ads控制台]              │
│     路径：Campaign → Assets → Logo      │
│     要求：1200×1200 或 1200×300 PNG/JPG │
│                                          │
│  2. 🖼️ 添加Image Extensions             │
│     路径：Campaign → Extensions         │
│     要求：至少3张，1200×628 PNG/JPG     │
│                                          │
│  3. ✅ 激活广告                          │
│     路径：Campaign → 修改状态为Enabled   │
│                                          │
│  [查看操作视频教程]                      │
│  [下载操作指南PDF]                       │
└─────────────────────────────────────────┘
```

**关键词智能分类**：

用户在Offer中输入的关键词自动分类：

| 关键词类型 | 匹配类型 | 判断规则 | 示例 |
|-----------|---------|---------|------|
| 品牌词 | EXACT | 包含品牌名 | "nike跑鞋" → EXACT |
| 产品核心词 | PHRASE | 2-3个词的产品词 | "跑步鞋" → PHRASE |
| 长尾词 | BROAD | ≥4个词 | "适合马拉松的专业跑鞋" → BROAD |

**用户可在创意生成页面查看和修改分类**。

**错误处理**：
- Google Ads API调用失败 → 显示错误原因 + 重试按钮
- 部分步骤失败 → 标记失败步骤，其他成功，允许继续
- Token过期 → 引导用户重新授权

**成功指标**：
- Campaign创建成功率 > 95%
- 用户完成Logo/Images上传率 > 60%
- 广告激活率 > 70%

---

### 3.5 广告系列数据每日同步

**功能描述**：
用户打开网页时，系统自动从Google Ads API同步昨日及历史性能数据，存储到后端SQLite数据库。前端从后端API获取数据并缓存。

**用户故事**：
> 作为广告主，我希望每次打开页面时自动看到最新的广告数据，无需手动刷新或等待。

**功能要求**：

**同步机制**：
```
触发条件：
1. 用户打开Dashboard页面
2. 用户手动点击"刷新数据"按钮
3. 每隔5分钟自动同步（页面打开时）

同步流程：
1. 检查上次同步时间
   └─ 如果距离上次同步 < 5分钟 → 跳过同步

2. 对每个Google Ads账号：
   ├─ 查询昨日性能数据（T+1数据）
   ├─ 查询Campaign元数据变化（名称、状态、预算）
   └─ 查询Google优化建议

3. 存储到后端数据库（upsert）
   └─ Key: ${accountId}-${campaignId}-${date}

4. 更新同步时间戳
   └─ 显示"最后同步时间: 2分钟前"
```

**同步数据范围**：

| 数据类型 | 同步范围 | 更新频率 | 存储位置 |
|---------|---------|---------|---------|
| Campaign性能数据 | 近90天 | 每日一次（T+1） | SQLite `campaign_performance` + 前端缓存 |
| Campaign元数据 | 全部活跃Campaign | 每次同步 | SQLite `campaigns` + 前端缓存 |
| 优化建议 | 全部待处理建议 | 每日一次 | SQLite `weekly_recommendations` |

**同步状态展示**：
```
┌─────────────────────────────────────────┐
│  🔄 正在同步数据...                      │
│  ━━━━━━━━━░░░░░░░░░░ 60%               │
│  已同步 3/5 个账号                       │
└─────────────────────────────────────────┘

同步完成后：
┌─────────────────────────────────────────┐
│  ✅ 数据已更新                           │
│  最后同步: 刚刚                          │
│  同步了 5 个账号, 23 个Campaign          │
│  [手动刷新]                              │
└─────────────────────────────────────────┘
```

**数据查询API**（从Google Ads）：
```graphql
SELECT
  campaign.id,
  campaign.name,
  campaign.status,
  segments.date,
  metrics.impressions,
  metrics.clicks,
  metrics.ctr,
  metrics.average_cpc,
  metrics.cost_micros,
  metrics.conversions,
  metrics.conversions_from_interactions_rate,
  metrics.cost_per_conversion,
  metrics.search_impression_share,
  metrics.search_rank_lost_impression_share
FROM campaign
WHERE
  segments.date >= '{90_days_ago}'
  AND campaign.status != 'REMOVED'
ORDER BY segments.date DESC
```

**数据保留策略**：
- 明细数据：保留90天
- 90天前数据：删除（用户可导出备份）

**错误处理**：
- API调用失败 → 显示错误提示，保留旧数据，允许重试
- Token过期 → 引导重新授权
- 网络断开 → 显示离线提示，使用本地缓存数据

**成功指标**：
- 同步成功率 > 98%
- 平均同步耗时 < 10秒
- 用户数据新鲜度 < 24小时

---

### 3.6 广告表现数据大盘展现

**功能描述**：
通过可视化图表和数据表格，展示Campaign性能数据、趋势分析、智能洞察。

**用户故事**：
> 作为广告主，我希望能一眼看到我的广告表现如何，哪些广告效果好，哪些需要优化，而不是在Google Ads后台的复杂报表中迷失。

**功能要求**：

**Dashboard页面结构**：

```
┌─────────────────────────────────────────────────────────────┐
│  AutoAds Dashboard                                          │
│  [日期范围: 近30天 ▼]  [账号: 全部 ▼]  [🔄 刷新数据]       │
└─────────────────────────────────────────────────────────────┘

┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 总展示次数   │ 总点击次数   │ 总花费       │ 总转化次数   │
│ 125,430     │ 3,862       │ ¥12,450     │ 127         │
│ +15% ↗      │ +8% ↗       │ +12% ↗      │ +22% ↗      │
└─────────────┴─────────────┴─────────────┴─────────────┘

┌─────────────────────────────────────────────────────────────┐
│  点击和展示趋势                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │     展示 (蓝)     点击 (绿)                            │  │
│  │  15K │                        ╱╲                       │  │
│  │      │                    ╱╲ ╱  ╲                      │  │
│  │  10K │              ╱╲   ╱  V    ╲╱╲                   │  │
│  │      │         ╱╲  ╱  ╲ ╱            ╲                 │  │
│  │   5K │    ╱╲  ╱  V     V              ╲                │  │
│  │      └─────────────────────────────────────────────────│  │
│  │        1/1  1/5  1/10  1/15  1/20  1/25  1/30         │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  点击率 (CTR) 趋势                                          │
│  [折线图显示30天CTR变化，行业基准线]                         │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Campaign列表                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ Campaign        状态   展示   点击  CTR    花费   转化  ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ Nike跑鞋-品牌   ✅    45.2K  1.2K  2.65%  ¥3,850  42   ││
│  │ Nike跑鞋-功能   ✅    38.1K  980   2.57%  ¥3,120  35   ││
│  │ Nike跑鞋-价值   ⏸     0      0     -      ¥0     0    ││
│  └─────────────────────────────────────────────────────────┘│
│  [查看更多...]                                               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  💡 智能洞察                                                 │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ ⚠️ CTR低于行业平均                                      ││
│  │ Campaign "Nike跑鞋-功能" CTR为2.57%，低于行业平均3.2%   ││
│  │ 建议：优化广告标题，增加号召性用语                       ││
│  │ [查看建议] [忽略]                                        ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ ✅ 转化成本优异                                          ││
│  │ Campaign "Nike跑鞋-品牌" CPA为¥92，低于目标CPA ¥120    ││
│  │ 建议：增加预算以扩大规模                                 ││
│  │ [调整预算] [忽略]                                        ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

**核心KPI指标**：

| 指标 | 英文名称 | 计算公式 | 展示格式 |
|------|---------|---------|---------|
| 展示次数 | Impressions | 直接从API | 125,430 |
| 点击次数 | Clicks | 直接从API | 3,862 |
| 点击率 | CTR | Clicks / Impressions | 3.08% |
| 平均点击成本 | Avg CPC | Cost / Clicks | ¥3.22 |
| 总花费 | Cost | 直接从API（micros转换） | ¥12,450 |
| 转化次数 | Conversions | 直接从API | 127 |
| 转化率 | CVR | Conversions / Clicks | 3.29% |
| 单次转化成本 | CPA | Cost / Conversions | ¥98.03 |

**趋势对比**：
- 显示环比变化（vs上一周期）
- 用颜色标识：绿色↗上升，红色↘下降
- 示例："总点击 3,862 (+8% ↗)"

**图表类型**：
1. **折线图**：展示/点击趋势、CTR趋势
2. **面积图**：花费趋势
3. **柱状图**：每日转化数量
4. **表格**：Campaign明细列表

**交互功能**：
- 点击Campaign行 → 跳转到Campaign详情页
- 悬停数据点 → 显示Tooltip（具体数值）
- 日期范围筛选：近7天/近30天/近90天/自定义
- 账号筛选：全部账号/单个账号

**智能洞察规则**：

| 洞察类型 | 触发条件 | 建议内容 | 优先级 |
|---------|---------|---------|-------|
| CTR过低 | CTR < 行业平均 × 0.8 | "优化标题，增加吸引力" | 高 |
| CPA优异 | CPA < 目标CPA × 0.8 | "增加预算扩大规模" | 中 |
| 花费超支 | 实际花费 > 预算 × 1.2 | "降低出价或暂停部分关键词" | 高 |
| 转化率低 | CVR < 行业平均 × 0.7 | "检查着陆页相关性" | 高 |
| 展示份额低 | 展示份额 < 50% | "提高出价或增加预算" | 中 |

**成功指标**：
- Dashboard加载时间 < 2秒
- 用户在Dashboard停留时间 > 2分钟
- 用户点击"查看建议"比例 > 40%

---

### 3.7 关键词搜索量查询

**功能描述**：
通过Google Ads Keyword Planner API查询用户输入的关键词在目标国家的真实搜索量、竞争程度和建议出价，帮助用户选择高价值关键词。

**用户故事**：
> 作为广告主,我想知道每个关键词在目标国家的真实搜索量和竞争情况,以便选择更有效的关键词投放广告。

**功能要求**：

**触发时机**：
1. Offer创建/编辑时,用户输入关键词后自动查询
2. 点击"查看关键词数据"按钮手动查询
3. "一键上广告"流程中自动查询并展示

**查询参数**：
| 参数 | 来源 | 说明 |
|------|------|------|
| 关键词列表 | 用户输入 | Offer中的关键词 |
| 目标国家 | Offer字段 | 如"US"、"GE"、"FR" |
| 推广语言 | 自动推导 | 根据国家映射(US→en, GE→de) |

**返回数据**：
| 数据项 | 说明 | 示例 |
|--------|------|------|
| 关键词 | 查询的关键词文本 | "security camera" |
| 月平均搜索量 | 近12个月平均搜索次数 | 45,000 |
| 竞争程度 | LOW/MEDIUM/HIGH | MEDIUM |
| 建议出价范围 | 低价位-高价位(货币微单位) | ¥3.20 - ¥8.50 |
| 竞争指数 | 0-100的数值 | 65 |

**数据展示界面**：
```
┌─────────────────────────────────────────────────────────────┐
│  关键词搜索量数据 (目标国家: 美国)                           │
├─────────────────────────────────────────────────────────────┤
│  关键词              月搜索量    竞争度    建议CPC范围       │
│  ─────────────────────────────────────────────────────────  │
│  security camera     45,000     ●●●○○    $3.20 - $8.50     │
│  outdoor camera      32,000     ●●●●○    $4.10 - $9.20     │
│  wireless camera     28,000     ●●○○○    $2.50 - $6.80     │
│  home security       89,000     ●●●●●    $5.50 - $12.30    │
│                                                              │
│  💡 洞察建议:                                                │
│  • "home security" 搜索量最高,但竞争激烈,CPC较高            │
│  • "wireless camera" 竞争较低,适合初期投放                 │
│  • 建议添加长尾词"outdoor wireless security camera"         │
│                                                              │
│  [导出数据]  [添加更多关键词]  [刷新数据]                  │
└─────────────────────────────────────────────────────────────┘
```

**数据存储**：
- 存储到后端数据库: `offers` 表的 `target_keywords` 字段（JSON格式）
- 缓存有效期: 7天(Google数据更新频率为周度)
- 过期后自动重新查询

**智能建议**：
基于查询结果生成建议:
- 搜索量 > 50K + 竞争度LOW/MEDIUM → "高价值关键词,建议优先投放"
- 搜索量 < 1K → "搜索量过低,建议更换关键词"
- 竞争度HIGH + 新账号 → "竞争激烈,建议从长尾词开始"
- 建议CPC > 预算*0.1 → "出价较高,注意控制预算"

**错误处理**：
- API调用失败 → 显示"暂时无法获取数据,请稍后重试"
- 关键词不支持 → 标记"该关键词无数据"
- 国家不支持 → 提示"该国家暂不支持搜索量查询"

**成功指标**：
- 查询成功率 > 95%
- 用户基于数据调整关键词比例 > 40%
- 平均查询响应时间 < 3秒

---

### 3.8 一键调整CPC

**功能描述**：
用户可以在Offer列表页点击"一键调整CPC"按钮,快速调整该Offer关联的所有Campaign的CPC出价,无需进入Google Ads后台。

**用户故事**：
> 作为广告主,当我发现某个Offer的广告表现不佳时,我希望能快速调整CPC出价,而不用登录Google Ads逐个修改。

**功能要求**：

**入口位置**：
- Offer列表页每个Offer卡片的操作栏
- 按钮文本: "⚙️ 调整CPC"
- 置于"一键上广告"和"一键下线"之间

**调整类型**：
| 调整类型 | 说明 | 使用场景 |
|---------|------|---------|
| 按百分比增加 | +5%, +10%, +20% | 展示份额低,需要提高排名 |
| 按百分比降低 | -5%, -10%, -20% | CPA过高,需要控制成本 |
| 设置固定值 | 直接设置CPC金额 | 精确控制出价策略 |

**交互流程**：
```
1. 用户点击"调整CPC"按钮
2. 弹出调整弹窗:
   ┌─────────────────────────────────────────┐
   │  调整CPC出价                             │
   ├─────────────────────────────────────────┤
   │  Offer: "2025春季促销 - Reolink摄像头"   │
   │  关联Campaign: 2个                       │
   │                                          │
   │  当前平均CPC: $4.50                      │
   │                                          │
   │  调整方式:                               │
   │  ○ 按百分比调整                          │
   │    [+] 5%  [+] 10%  [+] 20%             │
   │    [-] 5%  [-] 10%  [-] 20%             │
   │                                          │
   │  ○ 设置固定CPC                           │
   │    [____] USD                            │
   │                                          │
   │  预估新CPC: $4.95 (+10%)                │
   │                                          │
   │  ⚠️ 提示: CPC调整会影响广告展示和排名    │
   │                                          │
   │  [取消]  [确认调整]                      │
   └─────────────────────────────────────────┘

3. 用户选择调整方式并确认
4. 系统调用Google Ads API批量更新
5. 显示调整结果和新CPC值
```

**调整策略**：

**对于Manual CPC竞价策略**:
- 直接修改 `ad_group.cpc_bid_micros` 值
- 按比例调整: `new_cpc = current_cpc * (1 + percentage)`
- 固定值调整: `new_cpc = user_input_value`

**对于Smart Bidding策略**(Maximize Conversions/Target CPA):
- 修改 `target_cpa_micros` 或 `target_roas`
- 提示用户: "该Campaign使用智能出价,将调整目标CPA"

**对于Maximize Clicks策略**:
- 修改 `cpc_bid_ceiling_micros` (最高CPC上限)
- 提示用户: "该Campaign使用自动出价,将调整CPC上限"

**批量更新**：
```
1. 获取Offer关联的所有Campaign ID
2. 查询每个Campaign的竞价策略
3. 根据策略类型执行相应更新
4. 并行调用API更新(最多5个并发)
5. 记录更新结果(成功/失败)
```

**调整结果展示**：
```
┌─────────────────────────────────────────┐
│  ✅ CPC调整完成                          │
├─────────────────────────────────────────┤
│  已更新 2 个Campaign:                    │
│                                          │
│  ✓ Reolink摄像头 - 品牌导向              │
│    调整前: $4.20 → 调整后: $4.62 (+10%) │
│                                          │
│  ✓ Reolink摄像头 - 功能导向              │
│    调整前: $4.80 → 调整后: $5.28 (+10%) │
│                                          │
│  预计影响:                               │
│  • 展示量可能增加15-25%                  │
│  • 日均花费增加约10%                     │
│                                          │
│  [查看Campaign详情]  [关闭]             │
└─────────────────────────────────────────┘
```

**安全限制**：
- 单次调整幅度不超过±50%
- 调整后CPC不低于$0.10(防止过低)
- 调整后CPC不高于$100(防止误操作)
- 24小时内同一Offer最多调整3次

**错误处理**：
- API调用失败 → 显示失败Campaign,提供重试
- 部分成功 → 显示成功和失败列表
- 竞价策略不支持 → 提示"该Campaign使用[策略名],不支持手动调整"

**成功指标**：
- CPC调整成功率 > 90%
- 调整后7天内广告表现改善比例 > 50%
- 平均调整操作时间 < 30秒

---

### 3.9 系统配置管理

**功能描述**：
提供统一的配置页面,展示所有需要用户配置的系统设置,包括Google Ads账号连接、AI API密钥、默认广告参数等,支持热更新(修改后立即生效)。

**用户故事**：
> 作为用户,我希望在一个页面中管理所有系统配置,修改后立即生效,而不需要重启应用或重新登录。

**功能要求**：

**配置页面入口**：
- 顶部导航栏: "⚙️ 设置"
- 首次使用时强制引导用户完成必要配置

**配置页面结构**：
```
┌─────────────────────────────────────────────────────────────┐
│  ⚙️ 系统配置                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  【Google Ads 账号配置】                                     │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 已连接账号: 2个                                         │ │
│  │                                                         │ │
│  │ 1. 账号 123-456-7890 (主账号)                          │ │
│  │    Customer ID: 1234567890                             │ │
│  │    账号名称: Reolink US Marketing                      │ │
│  │    连接状态: ✅ 正常                                    │ │
│  │    最后同步: 5分钟前                                    │ │
│  │    [测试连接] [断开连接] [重新授权]                    │ │
│  │                                                         │ │
│  │ 2. 账号 098-765-4321                                   │ │
│  │    Customer ID: 9876543210                             │ │
│  │    账号名称: Reolink EU Marketing                      │ │
│  │    连接状态: ⚠️ Token即将过期(3天后)                   │ │
│  │    最后同步: 1小时前                                    │ │
│  │    [测试连接] [断开连接] [重新授权]                    │ │
│  │                                                         │ │
│  │ [+ 连接新账号]                                          │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  【AI 引擎配置】                                             │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 主引擎: Google Gemini 2.5                               │ │
│  │ API Key: [●●●●●●●●●●●●●●●●●●●●] 🔄                    │ │
│  │ 状态: ✅ 正常 (最后调用: 3分钟前)                       │ │
│  │ 剩余配额: 估计可用 (无法查询具体配额)                   │ │
│  │ [测试连接] [保存修改]                                   │ │
│  │                                                         │ │
│  │ 备用引擎: Anthropic Claude 4.5                          │ │
│  │ API Key: [●●●●●●●●●●●●●●●●●●●●] 🔄                    │ │
│  │ 状态: ✅ 正常 (备用,未调用)                             │ │
│  │ 自动切换: [✓] Gemini失败时自动使用Claude               │ │
│  │ [测试连接] [保存修改]                                   │ │
│  │                                                         │ │
│  │ 💡 提示: API Key加密存储在浏览器本地,不会上传到服务器   │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  【默认广告设置】                                            │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 默认每日预算:                                           │ │
│  │ [100] USD  (可在创建广告时修改)                         │ │
│  │                                                         │ │
│  │ 默认广告变体数量:                                       │ │
│  │ ○ 1个  ○ 2个  ● 3个                                    │ │
│  │                                                         │ │
│  │ 默认Campaign类型:                                       │ │
│  │ ● Search  ○ Performance Max (即将支持)                 │ │
│  │                                                         │ │
│  │ 关键词默认匹配类型:                                     │ │
│  │ [✓] 自动分类 (AI智能判断)                              │ │
│  │ [ ] 全部使用: ▼ PHRASE                                 │ │
│  │                                                         │ │
│  │ [保存设置]                                              │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  【数据同步设置】                                            │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 自动同步频率:                                           │ │
│  │ ● 每次打开页面  ○ 每5分钟  ○ 手动同步                  │ │
│  │                                                         │ │
│  │ 同步数据范围:                                           │ │
│  │ ● 近90天  ○ 近30天  ○ 近7天                            │ │
│  │                                                         │ │
│  │ 数据保留策略:                                           │ │
│  │ [✓] 自动删除90天前数据 (释放存储空间)                  │ │
│  │ [✓] 删除前提示备份                                     │ │
│  │                                                         │ │
│  │ 当前存储使用: 23.5 MB / 约50 MB限制                    │ │
│  │ [立即清理旧数据] [导出全部数据]                        │ │
│  │                                                         │ │
│  │ [保存设置]                                              │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  【安全与隐私】                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 本地数据加密:                                           │ │
│  │ [✓] 启用加密保护 (使用浏览器密码保护)                  │ │
│  │                                                         │ │
│  │ 数据备份:                                               │ │
│  │ 上次备份: 7天前                                         │ │
│  │ [立即备份到本地文件] [导入备份文件]                    │ │
│  │                                                         │ │
│  │ 数据隐私:                                               │ │
│  │ ✅ 数据安全存储在后端数据库，支持跨设备访问              │ │
│  │ ✅ API Key 使用 AES-256 加密                           │ │
│  │ ✅ Google OAuth Token 安全存储                         │ │
│  │ ⚠️ 清除浏览器数据会丢失所有配置,请定期备份              │ │
│  │                                                         │ │
│  │ [重置所有设置] (危险操作)                               │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  【高级设置】                                                │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 调试模式:                                               │ │
│  │ [ ] 启用详细日志 (用于问题排查)                        │ │
│  │                                                         │ │
│  │ 实验性功能:                                             │ │
│  │ [ ] 启用 Performance Max Campaign (Beta)               │ │
│  │ [ ] 启用关键词自动扩展建议 (Beta)                      │ │
│  │                                                         │ │
│  │ [保存设置]                                              │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ⚠️ 提示: 所有配置修改立即生效,无需重启应用                 │
└─────────────────────────────────────────────────────────────┘
```

**配置项分类**：

**必需配置** (首次使用时必须完成):
1. 连接至少1个Google Ads账号
2. 配置Gemini API Key (主引擎)

**可选配置** (有默认值):
1. Claude API Key (备用引擎)
2. 默认每日预算 (默认100 USD)
3. 默认广告变体数量 (默认3个)
4. 数据同步频率 (默认每次打开页面)

**热更新实现**：
```typescript
// 配置更新流程
async function updateConfig(key: string, value: any) {
  // 1. 验证配置值
  if (!validateConfig(key, value)) {
    throw new Error('配置值无效');
  }

  // 2. 保存到后端数据库
  await db.configs.put({ key, value, updatedAt: new Date() });

  // 3. 触发全局配置更新事件
  window.dispatchEvent(new CustomEvent('config-updated', {
    detail: { key, value }
  }));

  // 4. 显示成功提示
  showToast('配置已更新并立即生效', 'success');
}

// 监听配置更新
window.addEventListener('config-updated', (e) => {
  const { key, value } = e.detail;

  // 根据配置类型执行相应操作
  switch(key) {
    case 'gemini_api_key':
      // 重新初始化AI客户端
      initAIClient();
      break;
    case 'default_budget':
      // 更新全局默认值
      globalDefaults.budget = value;
      break;
    case 'sync_frequency':
      // 重新配置同步定时器
      configureSyncScheduler(value);
      break;
  }
});
```

**API Key 安全存储**：
```typescript
// 加密存储
async function saveAPIKey(provider: string, apiKey: string) {
  // 1. 提示用户设置加密密码 (首次)
  const password = await getUserPassword();

  // 2. 使用AES-256加密
  const encrypted = await crypto.subtle.encrypt(
    { name: 'AES-GCM', iv: generateIV() },
    await deriveKey(password),
    new TextEncoder().encode(apiKey)
  );

  // 3. 存储加密后的值
  await db.secrets.put({
    provider,
    encryptedKey: arrayBufferToBase64(encrypted),
    iv: ivToBase64(iv),
    createdAt: new Date()
  });
}

// 解密使用
async function getAPIKey(provider: string): Promise<string> {
  const secret = await db.secrets.get(provider);
  const password = getCachedPassword(); // 从内存缓存获取

  const decrypted = await crypto.subtle.decrypt(
    { name: 'AES-GCM', iv: base64ToIV(secret.iv) },
    await deriveKey(password),
    base64ToArrayBuffer(secret.encryptedKey)
  );

  return new TextDecoder().decode(decrypted);
}
```

**测试连接功能**：
- Google Ads账号: 调用 `customer.search('SELECT customer.id')` 测试
- Gemini API: 发送测试prompt验证
- Claude API: 调用 `/v1/messages` 测试端点

**成功指标**：
- 首次配置完成率 > 90%
- 配置修改后热更新成功率 100%
- API Key加密存储成功率 100%
- 用户定期备份数据比例 > 30%

---

### 3.10 Offer投放评分（Launch Score）

**功能描述**：
通过多维度数据分析和AI评估，为Offer提供投放ROI预测评分，帮助用户在投放前判断广告成功概率。

**用户故事**：
> 作为广告主，我希望在投放前就知道这个Offer的成功概率有多大，避免浪费预算在低ROI的广告上。

**功能要求**：

#### 触发入口

**Offer列表页操作栏**：
```
┌────────────────────────────────────────┐
│ Nike跑鞋春季促销                        │
│ ────────────────────────────────────── │
│ 品牌: Nike                             │
│ 国家: 美国 (US)                        │
│ 关键词: 5个                            │
│ 状态: Active                           │
│ 已创建广告: 2个                        │
│                                        │
│ [一键上广告]                           │
│ [💰 调整CPC]                           │
│ [📊 投放分析]  ← 新增按钮               │
│ [编辑] [...]                           │
└────────────────────────────────────────┘
```

#### 分析流程

**步骤1: 数据收集**（显示进度）
```
┌──────────────────────────────────────────────────────────┐
│ 投放分析中...                                    [×关闭] │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 正在收集数据...                                          │
│                                                          │
│ ✅ 步骤 1/5: 查询关键词搜索量数据                        │
│    获取到5个关键词的月搜索量和竞争度                     │
│                                                          │
│ 🔄 步骤 2/5: 抓取产品详情页                              │
│    正在分析: https://amazon.com/product/...              │
│                                                          │
│ ⏳ 步骤 3/5: 分析品牌知名度                              │
│ ⏳ 步骤 4/5: 评估着陆页质量                              │
│ ⏳ 步骤 5/5: AI综合评分                                  │
│                                                          │
│                     预计还需 15 秒...                    │
└──────────────────────────────────────────────────────────┘
```

**步骤2: AI评分**（计算中）
```
┌──────────────────────────────────────────────────────────┐
│ 🤖 AI正在分析投放潜力...                                 │
│                                                          │
│ 已收集数据:                                              │
│ • 关键词搜索量: 165,000/月                               │
│ • 平均CPC: ¥4.20                                         │
│ • 竞争程度: MEDIUM                                       │
│ • 产品评分: 4.6星 (2,340条评论)                         │
│ • 着陆页评分: 85/100                                     │
│                                                          │
│ 正在计算ROI预测...                                       │
└──────────────────────────────────────────────────────────┘
```

**步骤3: 显示评分结果**
```
┌──────────────────────────────────────────────────────────┐
│ 📊 投放分析报告 - Nike跑鞋春季促销              [×关闭]  │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│                     综合评分                              │
│                                                          │
│                    78 / 100                              │
│                     良好 ✅                               │
│                                                          │
│               ████████████████░░░░░░                     │
│                                                          │
│ 💡 评估结论：该Offer具有良好的投放潜力                   │
│    预计ROI: 2.5-3.5倍                                    │
│    建议初始预算: ¥150-200/天                             │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 详细评分 (5个维度)                                       │
│ ┌────────────────────────────────────────────────────────┤
│ │ 1. 关键词质量 (30分)                           26/30  │
│ │    ████████████████████████░░                         │
│ │    • 搜索量充足: 165,000/月 ✅                        │
│ │    • 竞争度适中: MEDIUM ✅                            │
│ │    • CPC合理: ¥3.20-¥8.50 ✅                         │
│ │                                                       │
│ │ 2. 产品市场匹配 (25分)                         21/25  │
│ │    ██████████████████████░░░                          │
│ │    • 产品评分高: 4.6星 ✅                             │
│ │    • 评论数充足: 2,340条 ✅                           │
│ │    • 品牌搜索量: 45,000/月 ⚠️ 偏低                   │
│ │                                                       │
│ │ 3. 着陆页质量 (20分)                           17/20  │
│ │    ████████████████████░░░░                           │
│ │    • 页面加载速度: 1.2秒 ✅                           │
│ │    • 移动端适配: 优秀 ✅                              │
│ │    • 转化元素: 较完善 ⚠️                             │
│ │                                                       │
│ │ 4. 预算竞争力 (15分)                            9/15  │
│ │    ████████████░░░░░░░░░                              │
│ │    • 建议预算: ¥150-200/天                            │
│ │    • 当前计划: ¥100/天 ⚠️ 建议提高                   │
│ │    • 出价竞争力: 中等 ⚠️                             │
│ │                                                       │
│ │ 5. 广告文案潜力 (10分)                          5/10  │
│ │    ██████████░░░░░░░░░░░                              │
│ │    • 关键词覆盖: 60% ⚠️                              │
│ │    • 创意多样性: 待生成 -                             │
│ └────────────────────────────────────────────────────────┘
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 🎯 优化建议                                               │
│ ┌────────────────────────────────────────────────────────┤
│ │ 1. ⚠️ 提高初始预算到¥150-200/天                        │
│ │    原因：当前预算相对搜索量和CPC偏低，可能限制曝光     │
│ │    预期影响：+15%展示量，+12%点击量                    │
│ │                                                        │
│ │ 2. ⚠️ 增加品牌词和长尾关键词                           │
│ │    建议添加：Nike running shoes, Nike Air Zoom        │
│ │    预期影响：+20%关键词覆盖率                          │
│ │                                                        │
│ │ 3. ✅ 着陆页优化建议                                    │
│ │    • 强化CTA按钮（更醒目的颜色和位置）                 │
│ │    • 添加用户评价展示区                                │
│ │    • 优化产品图片（添加多角度展示）                    │
│ │    预期影响：+8%转化率                                 │
│ └────────────────────────────────────────────────────────┘
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 📈 ROI预测（基于历史数据和AI模型）                        │
│ ┌────────────────────────────────────────────────────────┤
│ │ 保守估计 (50%概率)                                     │
│ │   月预算: ¥4,500                                       │
│ │   预计销售: ¥11,250                                    │
│ │   ROI: 2.5倍                                           │
│ │                                                        │
│ │ 中等估计 (30%概率)                                     │
│ │   月预算: ¥4,500                                       │
│ │   预计销售: ¥15,750                                    │
│ │   ROI: 3.5倍                                           │
│ │                                                        │
│ │ 乐观估计 (20%概率)                                     │
│ │   月预算: ¥4,500                                       │
│ │   预计销售: ¥22,500                                    │
│ │   ROI: 5.0倍                                           │
│ │                                                        │
│ │ 💡 说明：预测基于相似Offer的历史表现和AI分析           │
│ └────────────────────────────────────────────────────────┘
└──────────────────────────────────────────────────────────┘

                     [应用优化建议]  [开始投放]  [关闭]
```

#### 评分维度详解

**1. 关键词质量 (30分)**

| 子维度 | 权重 | 评分标准 | 数据来源 |
|--------|------|---------|---------|
| 搜索量充足性 | 15分 | 月搜索量 >50K: 15分<br>20K-50K: 10分<br>5K-20K: 5分<br><5K: 0分 | Keyword Planner API |
| 竞争度 | 10分 | LOW: 10分<br>MEDIUM: 7分<br>HIGH: 4分 | Keyword Planner API |
| CPC合理性 | 5分 | 低于行业均值: 5分<br>接近均值: 3分<br>高于均值: 1分 | Keyword Planner API |

**2. 产品市场匹配 (25分)**

| 子维度 | 权重 | 评分标准 | 数据来源 |
|--------|------|---------|---------|
| 产品评分 | 10分 | ≥4.5星: 10分<br>4.0-4.5星: 7分<br>3.5-4.0星: 4分<br><3.5星: 0分 | 产品详情页抓取 |
| 评论数量 | 10分 | >1000条: 10分<br>500-1000: 7分<br>100-500: 4分<br><100: 2分 | 产品详情页抓取 |
| 品牌知名度 | 5分 | 品牌词月搜索量 >100K: 5分<br>50K-100K: 3分<br><50K: 1分 | Keyword Planner API |

**3. 着陆页质量 (20分)**

| 子维度 | 权重 | 评分标准 | 数据来源 |
|--------|------|---------|---------|
| 页面加载速度 | 5分 | <2秒: 5分<br>2-4秒: 3分<br>>4秒: 0分 | 网站抓取时测量 |
| 移动端适配 | 5分 | 响应式设计: 5分<br>部分适配: 3分<br>不适配: 0分 | 网站抓取分析 |
| 转化元素 | 10分 | CTA明确+表单优化: 10分<br>有CTA无优化: 6分<br>无明确CTA: 2分 | AI分析页面内容 |

**4. 预算竞争力 (15分)**

| 子维度 | 权重 | 评分标准 | 计算方式 |
|--------|------|---------|---------|
| 预算充足性 | 10分 | 日预算 > 30×平均CPC: 10分<br>15-30×: 6分<br>5-15×: 3分<br><5×: 0分 | 预算/平均CPC |
| 出价竞争力 | 5分 | 出价高于建议范围中值: 5分<br>接近中值: 3分<br>低于中值: 1分 | 出价/建议CPC |

**5. 广告文案潜力 (10分)**

| 子维度 | 权重 | 评分标准 | 计算方式 |
|--------|------|---------|---------|
| 关键词覆盖率 | 5分 | 覆盖>80%关键词: 5分<br>60-80%: 3分<br><60%: 1分 | 已输入关键词数 |
| 创意多样性 | 5分 | 已生成创意: 5分<br>未生成: 0分 | 检查是否有创意 |

#### AI评分算法

**评分流程**：
```typescript
async function calculateLaunchScore(offer: Offer): Promise<LaunchScore> {
  // 1. 收集数据
  const keywordData = await fetchKeywordMetrics(offer.keywords, offer.targetCountry);
  const productData = await scrapeProductPage(offer.productPageUrl);
  const landingPageData = await analyzeLandingPage(offer.promotionUrl);
  const brandData = await fetchBrandPopularity(offer.brandName, offer.targetCountry);

  // 2. 计算各维度得分
  const keywordScore = calculateKeywordQuality(keywordData);       // 30分
  const productScore = calculateProductMarketFit(productData, brandData);  // 25分
  const landingScore = calculateLandingPageQuality(landingPageData);  // 20分
  const budgetScore = calculateBudgetCompetitiveness(offer, keywordData);  // 15分
  const contentScore = calculateAdContentPotential(offer);          // 10分

  // 3. 综合评分
  const totalScore = keywordScore + productScore + landingScore + budgetScore + contentScore;

  // 4. AI分析和建议
  const aiAnalysis = await generateAIRecommendations({
    offer,
    scores: { keyword: keywordScore, product: productScore, landing: landingScore, budget: budgetScore, content: contentScore },
    data: { keywordData, productData, landingPageData }
  });

  // 5. ROI预测
  const roiPrediction = predictROI(totalScore, keywordData, productData);

  return {
    totalScore,
    breakdown: { keywordScore, productScore, landingScore, budgetScore, contentScore },
    recommendations: aiAnalysis.recommendations,
    roiPrediction,
    dataCollectedAt: new Date().toISOString()
  };
}
```

**AI Prompt模板**：
```
Based on the following Offer data, provide optimization recommendations:

Offer: {offer.name}
Brand: {offer.brandName}
Target Country: {offer.targetCountry}
Keywords: {offer.keywords.join(', ')}

Data Analysis:
1. Keyword Quality Score: {keywordScore}/30
   - Total Search Volume: {totalSearchVolume}/month
   - Average Competition: {avgCompetition}
   - Average CPC: ${avgCPC}

2. Product Market Fit Score: {productScore}/25
   - Product Rating: {productRating} stars
   - Review Count: {reviewCount}
   - Brand Popularity: {brandSearchVolume}/month

3. Landing Page Score: {landingScore}/20
   - Load Speed: {loadSpeed}s
   - Mobile Friendly: {mobileFriendly}
   - CTA Quality: {ctaQuality}

4. Budget Score: {budgetScore}/15
   - Planned Budget: ${dailyBudget}/day
   - Recommended Budget: ${recommendedBudget}/day

5. Ad Content Score: {contentScore}/10
   - Keyword Coverage: {keywordCoverage}%

Please provide:
1. Top 3 optimization suggestions with expected impact
2. Specific actions for each suggestion
3. Risk factors to watch out for
4. Budget recommendations

Format your response as structured JSON.
```

#### 数据缓存策略

**缓存规则**：
```typescript
interface LaunchScoreCache {
  offerId: string;
  score: LaunchScore;
  cachedAt: string;
  expiresAt: string;  // 缓存7天
}

// 缓存失效条件
function shouldRecalculate(offer: Offer, cache: LaunchScoreCache): boolean {
  const cacheExpired = new Date(cache.expiresAt) < new Date();
  const offerModified = new Date(offer.updatedAt) > new Date(cache.cachedAt);

  return cacheExpired || offerModified;
}
```

**重新计算触发**：
- 缓存过期（7天）
- Offer关键字段修改（关键词、国家、预算等）
- 用户手动点击"重新分析"

#### 成功指标

**功能使用**：
- 投放分析使用率 > 60%（至少60%的Offer被分析过）
- 分析完成率 > 95%（分析流程完成，不中途退出）
- 平均分析耗时 < 30秒

**评分准确性**：
- 高分Offer(>70分)的投放成功率 > 70%
- 低分Offer(<50分)的投放失败率 > 60%
- ROI预测误差 < 30%

**用户行为**：
- 采纳优化建议比例 > 40%
- 高分Offer投放率 > 80%
- 低分Offer修改后重新分析率 > 50%

---

## 4. 次要功能需求

### 4.1 内容编辑能力

**需求**：用户可以直接编辑AI生成的Headlines、Descriptions、Callouts、Sitelinks。

**实现**：
- Inline编辑（点击即编辑）
- 实时字符计数和验证
- 支持添加/删除创意元素
- 标记用户编辑的内容（与AI生成区分）

### 4.2 历史版本管理和对比

**需求**：保存每次生成的创意版本，支持版本对比和恢复。

**实现**：
- 每次生成创建新版本（Version 1, 2, 3...）
- 版本列表显示质量评分
- 并排对比2个版本的差异
- 一键恢复到历史版本

### 4.3 关键词智能分类优化

**需求**：自动分类关键词匹配类型，用户可覆盖。

**实现**：
- 品牌词 → EXACT
- 产品核心词 → PHRASE
- 长尾词（≥4词）→ BROAD
- 自动生成否定关键词建议
- 用户可手动修改分类

### 4.4 合规性检查

**需求**：检查广告内容是否违反Google Ads政策。

**实现**：
- 禁止内容检测（处方药、赌博、成人内容）
- 编辑规范检测（多个感叹号、全大写）
- 限制行业检测（医疗、金融需特殊许可）
- 违规时显示警告并提供修改建议

### 4.5 成本预估和ROI预测

**需求**：基于行业数据预估广告成本和ROI。

**实现**：
- 调用Google Keyword Planner API获取预估CPC
- 计算预估点击量、转化量、CPA
- 显示30天ROI预测
- 与行业基准对比

### 4.6 智能优化建议（基于真实数据）

**需求**：调用Google Ads Recommendations API，提供优化建议。

**实现**：
- 每日同步Google优化建议
- 显示建议类型：关键词扩展、预算调整、资源添加
- 显示预期影响（展示、点击、转化提升）
- 支持一键应用建议

### 4.7 数据导出/导入

**需求**：用户可以导出本地数据到JSON文件，在其他设备导入。

**实现**：
- 导出所有数据为JSON（通过后端API）
- 导入时支持"替换"或"合并"模式
- 导入前验证数据格式和版本兼容性
- 提供备份提醒（建议每周导出一次）

---

## 5. 非功能性需求

### 5.1 性能要求

| 指标 | 目标值 | 测量方法 |
|------|-------|---------|
| 页面首次加载时间 | < 3秒 | Lighthouse FCP |
| Dashboard加载时间 | < 2秒 | 自定义埋点 |
| AI创意生成时间 | < 15秒 | 后端日志 |
| 数据同步时间 | < 10秒（5个账号） | 自定义埋点 |
| 数据库查询时间 | < 100ms | Performance API |

### 5.2 兼容性要求

| 类别 | 要求 |
|------|------|
| 浏览器 | Chrome 90+, Safari 14+, Firefox 88+, Edge 90+ |
| 设备 | 桌面端优先，移动端响应式支持 |
| 操作系统 | Windows 10+, macOS 11+, Linux |
| 网络 | 支持离线查看历史数据，联网时自动同步 |

### 5.3 安全性要求

| 要求 | 实现方案 |
|------|---------|
| OAuth Token保护 | 前端加密存储（AES-256），用户设置密码保护 |
| HTTPS强制 | 生产环境强制HTTPS，CSP策略防止XSS |
| API密钥保护 | Google Ads API密钥通过环境变量配置，不暴露到前端 |
| 数据隐私 | 用户数据存储在浏览器本地，不上传服务器 |

### 5.4 可用性要求

| 要求 | 目标 |
|------|------|
| 系统可用性 | 99.5% uptime |
| 错误恢复 | 所有API调用失败提供重试机制 |
| 用户引导 | 首次使用提供交互式教程 |
| 帮助文档 | 每个功能提供"?"图标链接到帮助文档 |

### 5.5 数据可靠性要求

| 要求 | 实现方案 |
|------|---------|
| 数据备份 | 引导用户每周导出数据备份 |
| 数据恢复 | 提供导入功能恢复备份数据 |
| 数据一致性 | 同步时使用upsert避免重复，冲突解决策略为"最新优先" |

---

## 6. 用户体验设计原则

### 6.1 设计理念

**核心原则**：
1. **简单至上**：每个操作步骤不超过3步
2. **即时反馈**：所有操作立即显示结果或进度
3. **智能默认**：提供最佳实践的默认配置
4. **可控性**：AI生成的内容用户可编辑和覆盖

### 6.2 交互规范

**按钮设计**：
- 主要操作：蓝色填充按钮（如"一键上广告"）
- 次要操作：灰色边框按钮（如"取消"）
- 危险操作：红色边框按钮（如"删除"）

**状态展示**：
- 成功：绿色 ✅
- 警告：黄色 ⚠️
- 错误：红色 ❌
- 进行中：蓝色 🔄

**加载状态**：
- 短时操作（<3秒）：显示Spinner
- 长时操作（>3秒）：显示进度条和当前步骤

**错误提示**：
- 显示具体错误原因
- 提供解决建议或重试按钮
- 不使用技术术语，用通俗语言

### 6.3 信息架构

```
AutoAds
├── Dashboard（数据大盘）
│   ├── 概览
│   ├── Campaign列表
│   └── 智能洞察
├── Offers（营销主张管理）
│   ├── Offer列表
│   ├── 创建Offer
│   └── 编辑Offer
├── Campaigns（广告系列）
│   ├── Campaign列表
│   ├── Campaign详情
│   └── 优化建议
├── 创意库（历史创意版本）
│   ├── 按Offer查看
│   ├── 版本对比
│   └── 创意模板
├── 账号管理
│   ├── Google Ads账号列表
│   ├── 连接新账号
│   └── 同步设置
└── 设置
    ├── 数据导出/导入
    ├── 安全设置（密码保护）
    └── 帮助与支持
```

---

## 7. 成功指标（KPIs）

### 7.1 产品使用指标

| 指标 | 目标值 | 测量频率 |
|------|-------|---------|
| 活跃用户数 | 1000+ | 月度 |
| 新用户注册数 | 200+/月 | 月度 |
| 用户留存率（7天） | > 40% | 周度 |
| 用户留存率（30天） | > 25% | 月度 |
| 平均创建Offer数 | > 5个/用户 | 月度 |
| 平均创建Campaign数 | > 3个/用户 | 月度 |

### 7.2 功能使用指标

| 指标 | 目标值 | 说明 |
|------|-------|------|
| "一键上广告"使用率 | > 80% | Offer创建后使用"一键上广告"的比例 |
| AI创意生成成功率 | > 98% | AI成功生成创意的比例 |
| 创意重新生成率 | < 30% | 用户对首次生成不满意重新生成的比例 |
| 创意编辑率 | < 40% | 用户手动编辑AI生成内容的比例 |
| Campaign创建成功率 | > 95% | API调用成功创建的比例 |
| 数据同步成功率 | > 98% | 自动同步成功的比例 |

### 7.3 业务影响指标

| 指标 | 目标值 | 说明 |
|------|-------|------|
| 平均创建广告耗时 | < 5分钟 | 从点击按钮到广告上线 |
| 用户满意度（NPS） | > 40 | 净推荐值 |
| AI创意质量评分 | > 75/100 | 平均质量评分 |
| 广告激活率 | > 70% | 创建后用户激活广告的比例 |

---

## 8. 里程碑规划

### Phase 1: MVP核心功能（4周）
**目标**：实现最小可用产品，验证核心价值

**交付物**：
- ✅ Offer创建和管理
- ✅ AI创意生成（带Fallback）
- ✅ 质量评分和重新生成
- ✅ Google Ads Campaign创建
- ✅ 后端数据库存储（SQLite）

**成功标准**：
- 10个内测用户成功创建广告
- 平均创建时间 < 10分钟
- AI生成成功率 > 95%

### Phase 2: 数据同步和可视化（3周）
**目标**：实现数据闭环，提供优化决策依据

**交付物**：
- ✅ 数据自动同步服务
- ✅ Dashboard数据大盘
- ✅ Campaign性能图表
- ✅ 智能洞察面板

**成功标准**：
- 同步成功率 > 98%
- Dashboard加载 < 2秒
- 用户查看Dashboard停留 > 2分钟

### Phase 3: 增强功能（3周）
**目标**：完善用户体验，提高产品竞争力

**交付物**：
- ✅ 内容编辑能力
- ✅ 历史版本管理
- ✅ 关键词智能分类优化
- ✅ 合规性检查
- ✅ 数据导出/导入

**成功标准**：
- 创意编辑率 < 40%
- 合规检查拦截违规内容 > 90%
- 数据导出使用率 > 20%

### Phase 4: 优化和扩展（2周）
**目标**：优化性能，集成高级功能

**交付物**：
- ✅ 成本预估和ROI预测
- ✅ Google Ads Recommendations API集成
- ✅ 性能优化（加载速度、数据库查询、API响应）
- ✅ 用户引导和帮助文档

**成功标准**：
- 页面加载 < 3秒
- ROI预测准确度 > 70%
- 优化建议应用率 > 30%

---

## 9. 风险和应对

### 9.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| Google Ads API配额限制 | 高 | 中 | 实现智能限流和缓存，避免重复调用 |
| AI生成质量不稳定 | 中 | 中 | 多次测试优化Prompt，提供Fallback模板 |
| 数据库容量管理 | 低 | 低 | 后端SQLite自动管理，实现90天数据清理 |
| OAuth Token被盗 | 高 | 低 | 前端加密存储，用户密码保护，定期刷新Token |

### 9.2 业务风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 用户不信任AI生成 | 高 | 中 | 提供质量评分和重新生成，允许用户编辑 |
| 竞品模仿 | 中 | 高 | 快速迭代，建立用户社区和品牌 |
| Google政策变化 | 高 | 低 | 持续关注Google Ads政策，快速适配 |
| 用户流失 | 高 | 中 | 持续优化体验，提供优质内容和支持 |

### 9.3 运营风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 用户数据丢失 | 高 | 低 | 引导用户定期备份，提供数据恢复工具 |
| 用户支持成本高 | 中 | 中 | 完善帮助文档，提供视频教程，建立FAQ |
| 服务器成本超预期 | 低 | 低 | 前端本地存储架构，最小化后端资源 |

---

## 10. 附录

### 10.1 术语表

| 术语 | 定义 |
|------|------|
| Offer | 营销主张/产品推广，包含品牌名、产品描述、关键词等信息 |
| Campaign | Google Ads广告系列，包含预算、目标、广告组 |
| RSA | Responsive Search Ad，响应式搜索广告 |
| Headlines | 广告标题，最多15个，每个≤30字符 |
| Descriptions | 广告描述，最多4个，每个≤90字符 |
| Callout | 附加信息，展示产品特点/优势，每个≤25字符 |
| Sitelink | 附加链接，引导用户到网站特定页面 |
| CTR | Click-Through Rate，点击率 = 点击数 / 展示数 |
| CPC | Cost Per Click，单次点击成本 |
| CPA | Cost Per Acquisition，单次转化成本 |
| CVR | Conversion Rate，转化率 = 转化数 / 点击数 |
| SQLite | 轻量级嵌入式数据库，后端数据持久化存储 |
| Fallback | 降级策略，当主要方案失败时的备选方案 |

### 10.2 参考资料

- [Google Ads API Documentation](https://developers.google.com/google-ads/api/docs/start)
- [Responsive Search Ads Best Practices](https://support.google.com/google-ads/answer/7684791)
- [SQLite Documentation](https://www.sqlite.org/docs.html)
- [better-sqlite3](https://github.com/WiseLibs/better-sqlite3)
- [Google Ads Policy Center](https://support.google.com/adspolicy)

---

**文档版本**: 1.0
**最后更新**: 2025-01-17
**下一次审查**: 2025-02-01
